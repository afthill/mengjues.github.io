<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>阅读笔记：OReilly 《AngularJS: up and running》 | Make Fun</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="AngularJS存在的意义 传统的HTML+jQuery/Javascript框架开发的前端逻辑是放在Javascript脚本里，HTML只有展示元素的作用。  AngularJS可以把前端逻辑放在HTML中，通过阅读HTML直接可以得到内在的前端业务逻辑   AngularJS的基本MVC架构 Model  是前端框架所使用到的数据 数据一般来自于后台的服务   View  是用户看到的UI">
<meta name="keywords" content="AngularJS">
<meta property="og:type" content="article">
<meta property="og:title" content="阅读笔记：OReilly 《AngularJS: up and running》">
<meta property="og:url" content="http://m.imf.cc/2015/11/27/Reading-Note-OReilly-Introduction-To-AngularJS/index.html">
<meta property="og:site_name" content="Make Fun">
<meta property="og:description" content="AngularJS存在的意义 传统的HTML+jQuery/Javascript框架开发的前端逻辑是放在Javascript脚本里，HTML只有展示元素的作用。  AngularJS可以把前端逻辑放在HTML中，通过阅读HTML直接可以得到内在的前端业务逻辑   AngularJS的基本MVC架构 Model  是前端框架所使用到的数据 数据一般来自于后台的服务   View  是用户看到的UI">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-01-31T01:39:44.276Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="阅读笔记：OReilly 《AngularJS: up and running》">
<meta name="twitter:description" content="AngularJS存在的意义 传统的HTML+jQuery/Javascript框架开发的前端逻辑是放在Javascript脚本里，HTML只有展示元素的作用。  AngularJS可以把前端逻辑放在HTML中，通过阅读HTML直接可以得到内在的前端业务逻辑   AngularJS的基本MVC架构 Model  是前端框架所使用到的数据 数据一般来自于后台的服务   View  是用户看到的UI">
  
  
  <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/open-fonts/css/open-sans.css">
  <link rel="stylesheet" href="/open-fonts/css/share-tech-mono.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  

</head>
</html>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo"></i><span class="site-title">Make Fun</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/css/images/avatar.png"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://m.imf.cc"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/">Home</a></td>
      
        <td><a class="main-nav-link" href="/archives">Archives</a></td>
      
        <td><a class="main-nav-link" href="/about">About</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://m.imf.cc"></form>
      </td>
      </tr>
    </table>
  </div>
  
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="/css/images/avatar.png">
      <h2 id="name">Meng Jue (M)</h2>
      <h3 id="title">Strict Developer &amp; Funny Player</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Shanghai, China</span>
      <a id="follow" href="https://github.com/MengjueM">关注我</a>
  	</div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        319
        <span>文章</span>
      </div>
      <div class="article-info-block">
        236
        <span>标签</span>
      </div>
    </div>
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a href="http://github.com/MengjueM" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a href="#" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="#" title="facebook"><i class="fa fa-facebook"></i></a></td>
        
          <td><a href="#" title="dribbble"><i class="fa fa-dribbble"></i></a></td>
        
          <td><a href="/atom.xml" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
  </div>
</aside>
      <section id="main"><article id="post-Reading-Note-OReilly-Introduction-To-AngularJS" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      阅读笔记：OReilly 《AngularJS: up and running》
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/11/27/Reading-Note-OReilly-Introduction-To-AngularJS/">
    <time datetime="2015-11-27T05:25:00.000Z" itemprop="datePublished">2015-11-27</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Coding/">程序语言</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="AngularJS存在的意义"><a href="#AngularJS存在的意义" class="headerlink" title="AngularJS存在的意义"></a>AngularJS存在的意义</h3><ul>
<li><p>传统的HTML+jQuery/Javascript框架开发的前端逻辑是放在Javascript脚本里，HTML只有展示元素的作用。</p>
</li>
<li><p>AngularJS可以把前端逻辑放在HTML中，通过阅读HTML直接可以得到内在的前端业务逻辑</p>
</li>
</ul>
<h3 id="AngularJS的基本MVC架构"><a href="#AngularJS的基本MVC架构" class="headerlink" title="AngularJS的基本MVC架构"></a>AngularJS的基本MVC架构</h3><ul>
<li><p>Model</p>
<ul>
<li>是前端框架所使用到的数据</li>
<li>数据一般来自于后台的服务</li>
</ul>
</li>
<li><p>View</p>
<ul>
<li>是用户看到的UI</li>
<li>用户通过View与前端程序交互</li>
</ul>
</li>
<li><p>Controller</p>
<ul>
<li>业务逻辑放在这里</li>
<li>是一个呈现层（Presentation Layer），用来驱动View（UI Layer）的展示与变化</li>
<li>某些实现把这个称为<em>viewmodel</em>，或者<em>representer</em></li>
</ul>
</li>
</ul>
<h3 id="Angular的特点："><a href="#Angular的特点：" class="headerlink" title="Angular的特点："></a>Angular的特点：</h3><ol>
<li><p>Data-driven</p>
<ul>
<li>通过data-binding实现</li>
<li>data在服务器端和客户端双向自由流动，并且自我呈现，不需要人为干预</li>
</ul>
</li>
<li><p>Declarative</p>
<ul>
<li>与declarative相对应的是imperative paradigm</li>
<li>declarative的模式不需要详细定义每个step的细节</li>
<li>declarative在HTML中声明所需要的逻辑，实现由angular的内部去实现</li>
<li><p>示例:</p>
<pre><code>&lt;tabs&gt;
    &lt;tab title=&quot;Home&quot;&gt;Some content here&lt;/tab&gt;
    &lt;tab title=&quot;Profile&quot;&gt;
        &lt;input type=&quot;text&quot;
            datepicker
            ng-model=&quot;startDate&quot;/&gt;
    &lt;/tab&gt;
&lt;/tabs&gt;
</code></pre></li>
</ul>
</li>
<li><p>Separate your concerns</p>
<ul>
<li><p>使用MVC或者MVC-like结构去重新定义前端的设计</p>
<ul>
<li>涉及数据部分？放在model里</li>
<li>涉及UI部分？放在view里</li>
<li>涉及业务逻辑部分？放在controller里</li>
</ul>
</li>
<li><p>Angular的MVC架构并不是纯粹意义的MVC，Angular的Controller并不直接与View交互</p>
</li>
</ul>
</li>
<li><p>Dependency Injection</p>
<ul>
<li>AngularJS完整地支持DI</li>
<li>DI是一个Java中非常常见的设计模式：<ul>
<li>通过接口约束依赖的的controller或者service的规格</li>
<li>在服务的调用端，不需要通过new关键词或者function去实例化所依赖的对象</li>
</ul>
</li>
</ul>
</li>
<li><p>Extensible</p>
<ul>
<li>AngularJS通过提供builtin的directives去实现它的行为</li>
<li>这些指令集（directive）是放在HTML标签声明</li>
<li>后台的Javascript脚本通过阅读和翻译directive，去生成可以在浏览器执行的代码</li>
<li>用户可以提供自己的directive扩展</li>
</ul>
</li>
<li><p>Test first, test again, keep testing</p>
<ul>
<li>controller, services, directives, views, routes均被设计的容易测试</li>
<li>fast test runner: Karma</li>
<li>Protractor, WebDriver based UI testing runner</li>
</ul>
</li>
</ol>
<a id="more"></a>
<h3 id="如何开始"><a href="#如何开始" class="headerlink" title="如何开始"></a>如何开始</h3><h4 id="About-ng-app"><a href="#About-ng-app" class="headerlink" title="About ng-app"></a>About ng-app</h4><p>ng-app是angular用来确定它所使用的框架的工作范围，比如如果想在整个的HTML的页面中使用，我可以规定<code>&lt;html ng-app&gt;</code>，如果只在部分标签中使用，我们可以<code>&lt;div ng-app&gt;</code></p>
<h4 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">D:\restangular&gt;tree /A /F</span><br><span class="line">Folder PATH listing</span><br><span class="line">Volume serial number is 1406-1BE6</span><br><span class="line">D:.</span><br><span class="line">|   basic-angularjs-app.html</span><br><span class="line">|</span><br><span class="line">\---lib</span><br><span class="line">    \---vendor</span><br><span class="line">        \---angular1.2.19</span><br><span class="line">                angular.js</span><br></pre></td></tr></table></figure>
<h4 id="第一个Angular程序"><a href="#第一个Angular程序" class="headerlink" title="第一个Angular程序"></a>第一个Angular程序</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello &#123;&#123; 1 + 2&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"lib/vendor/angular1.2.19/angular.js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="关键点："><a href="#关键点：" class="headerlink" title="关键点："></a>关键点：</h5><ul>
<li><p>ng-app directive，这是angular最重要的directive，用来控制angular的工作的范围（scope），如果放在<code>&lt;html&gt;</code>节点，则表示Angular可以控制整个页面</p>
</li>
<li><p><code>{{ }}</code><br>Angular的data binding，有的时候我们也可以放<code>angular expression</code>在里面</p>
</li>
</ul>
<h5 id="第一个Hello-World"><a href="#第一个Hello-World" class="headerlink" title="第一个Hello World"></a>第一个Hello World</h5><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">        &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body ng-app&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; ng-model=&quot;name&quot; placeholder=&quot;Enter your name&quot;/&gt;</span><br><span class="line">        &lt;h1&gt;Hello &lt;span ng-bind=&quot;name&quot;&gt;&lt;/span&gt;&lt;/h1&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;lib/vendor/angular1.2.19/angular.js&quot;&gt;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="AngularJS-Modules"><a href="#AngularJS-Modules" class="headerlink" title="AngularJS Modules"></a>AngularJS Modules</h3><ul>
<li>module类似于Java中的package，是一个container</li>
<li>module内部可以包含自己的controller, services, factories, and directives，这些内部的功能可以通过module去访问</li>
<li>module可以有依赖（dependencies）</li>
</ul>
<h4 id="如何声明module"><a href="#如何声明module" class="headerlink" title="如何声明module"></a>如何声明module</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">angular.module(&apos;notesApp&apos;, [])</span><br></pre></td></tr></table></figure>
<p>第一个参数是module名字，第二个<code>[]</code>是该module所需要的依赖（dependencies）</p>
<h4 id="如果加载存在的angular-module"><a href="#如果加载存在的angular-module" class="headerlink" title="如果加载存在的angular module"></a>如果加载存在的angular module</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">angular.module(&apos;notesApp&apos;);</span><br></pre></td></tr></table></figure>
<p>可能存在的错误：</p>
<ul>
<li>忘记使用<code>angular.module(&#39;moduleName&#39;, [dependencies,])</code>函数签名，改函数是用来的创建新的module的，如果使用<code>angular.module(&#39;moduleName&#39;)</code>则是直接加载存在的module</li>
<li>在module的文件没有被加载前而直接加载module，当然当前angular系统是查找不到该module</li>
<li>bootstrap module是用来启动angular程序，需要在ng-app中作为可选参数声明</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello &#123;&#123; 1 + 2&#125;&#125;nd time AngularJS</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"lib/vendor/angular1.2.19/angular.js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span></span><br><span class="line"><span class="undefined">        angular.module('nnoteApp', []);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><p>Controller是angular种workhorse（工马），用来做大部分UI控制方面的工作：</p>
<ul>
<li>为UI去获得从server端传送的数据</li>
<li>决定那些数据要展示给User</li>
<li>如何展示元素，那部分元素需要被展示</li>
<li>用户交互方面控制（click listener）</li>
</ul>
<h4 id="如何创建controller"><a href="#如何创建controller" class="headerlink" title="如何创建controller"></a>如何创建controller</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"name"</span> <span class="attr">placeholder</span>=<span class="string">"Enter your name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"name"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"lib/vendor/angular1.2.19/angular.js"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        angular.module("notesApp", []).controller("MainCtrl", [</span></span><br><span class="line"><span class="undefined">            function () &#123;</span></span><br><span class="line"><span class="undefined">                console.log("MainCtrl has been created");</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        ]);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们这里引入一个新的angular directive，<code>ng-controller</code>，ng-controller后面有一个参数，是用来告诉angular可以用所给的controller的名字去初始化一个controller对象，并把这个controller绑定到DOM的元素上。</p>
<p>我们新创建的controler，使用了<code>angular.module(...).controller(&quot;controllerName&quot;, [dependencies, function])</code>的签名：</p>
<ul>
<li>第一个参数是controller的名字</li>
<li>第二个参数是一个list<code>[]</code>，里面有一个可选参数，controller的所有dependencies的列表，而最后一个参数是function，用来处理controller实际要做的工作</li>
</ul>
<p>然后进一步来看一个实例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line">&#123;&#123; ctrl.helloMsg &#125;&#125; AngularJS.</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">&#123;&#123; ctrl.goodbyeMsg &#125;&#125; AngularJS.</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    angular.module("notesApp", [])</span></span><br><span class="line"><span class="undefined">            .controller("MainCtrl", [function () &#123;</span></span><br><span class="line"><span class="undefined">                this.helloMsg = "Hello ";</span></span><br><span class="line"><span class="undefined">                var goodbyeMsg = "Goodbye ";</span></span><br><span class="line"><span class="undefined">            &#125;])</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析一下上面的实例：</p>
<ul>
<li>创建了一个notesApp module</li>
<li>创建了一个“MainCtrl” controller，并且使用了ctrl作为实例名</li>
<li>定义了一个本地变量goodbyeMsg，通过关键词var，这个变量不会在页面中显示</li>
<li>定义了一个实例变量helloMsg</li>
<li>通过ng-controller directive绑定要HTML的元素body上</li>
<li>使用<code>{{ }}</code>去refer（引用）controller实例中的变量</li>
</ul>
<h4 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h4><p>上面的实例实际有2个scope：</p>
<ul>
<li>一个是controller自身的scope，这个scope里用var声明的变量只能在controller里使用，不会逃逸（escape）到controller外面</li>
<li>一个是DOM里面的scope，由于controller自身被angular初始化之后，被绑定到DOM上，所以DOM中的节点就有一个对controller的实例访问的能力，比如上例中的this所带的state就可以被DOM访问到</li>
</ul>
<p>进一步复杂的实例：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line">&#123;&#123; ctrl.message &#125;&#125; AngularJS.</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.changeMessage()"</span>&gt;</span></span><br><span class="line">    Change Message</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    angular.module("notesApp", [])</span></span><br><span class="line"><span class="undefined">            .controller("MainCtrl", [function () &#123;</span></span><br><span class="line"><span class="undefined">                var self = this;</span></span><br><span class="line"><span class="undefined">                self.message = "Hello ";</span></span><br><span class="line"><span class="undefined">                self.count = 0;</span></span><br><span class="line"><span class="undefined">                self.changeMessage = function () &#123;</span></span><br><span class="line"><span class="undefined">                    console.log(self.count);</span></span><br><span class="line"><span class="undefined">                    if (self.count % 2 == 0) &#123;</span></span><br><span class="line"><span class="undefined">                        self.message = "Goodbye ";</span></span><br><span class="line"><span class="undefined">                    &#125; else &#123;</span></span><br><span class="line"><span class="undefined">                        self.message = "Hello ";</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                    self.count++;</span></span><br><span class="line"><span class="undefined">                &#125;;</span></span><br><span class="line"><span class="undefined">            &#125;]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析如下：</p>
<ul>
<li>只有一个binding，就是ctrl.message变量</li>
<li>使用了一个内建的（built-in）directive，<code>ng-click</code>，<code>ng-click</code>directive将会在任何button被click的时候执行传入的expression，我们这里是调用了一个<code>changeMessage</code>的function。</li>
<li>changeMessage被执行时，改变了实例的message变量（goodbye）</li>
<li><code>self=this</code>是一个复杂的Javascript绑定context技巧，因为this是在运行时被动态判定，所以这里在第一次被DOM调用时，就用self限定了context，后面通过closure，可以把DOM的context传给后面执行的函数</li>
</ul>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>Angular应用程序是一个数据驱动的app，“model”是angular开发中唯一关注的真相，而涉及到更新UI等类似的底层的工作，是由angular帮开发者自动完成的。</p>
<h4 id="declarative-ng-repeat"><a href="#declarative-ng-repeat" class="headerlink" title="declarative: ng-repeat"></a>declarative: ng-repeat</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">"note in ctrl.notes"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label"</span>&gt;</span>&#123;&#123; note.label &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"status"</span> <span class="attr">ng-bind</span>=<span class="string">"note.done"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    angular.module("notesApp", [])</span></span><br><span class="line"><span class="undefined">            .controller("MainCtrl", [function () &#123;</span></span><br><span class="line"><span class="undefined">                var self = this;</span></span><br><span class="line"><span class="undefined">                self.notes = [</span></span><br><span class="line"><span class="undefined">                    &#123;id: 1, label: 'First Note', done: false&#125;,</span></span><br><span class="line"><span class="undefined">                    &#123;id: 2, label: 'Second Note', done: false&#125;,</span></span><br><span class="line"><span class="undefined">                    &#123;id: 3, label: 'Done Note', done: true&#125;,</span></span><br><span class="line"><span class="undefined">                    &#123;id: 4, label: 'Last Note', done: false&#125;</span></span><br><span class="line"><span class="undefined">                ]</span></span><br><span class="line"><span class="undefined">            &#125;]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析如下：</p>
<ul>
<li>我们引入了一组array的JSON对象</li>
<li>我们把引入的array放在controller的实例对象里</li>
<li>我们使用ng-repeat去展示array里的数据</li>
<li>使用ng-repeat时所绑定的HTML DOM实际上ng-repeat的template</li>
<li>ng-repeat类似于<code>foo each</code>LOOP</li>
<li>展示内容使用了2种技术：<ul>
<li>ng-bind</li>
<li><code>{{ }}</code>expression</li>
<li>没有真正的区别，都是有angular来管理数据的更新</li>
<li>唯一的区别是：<ul>
<li>ng-bind在angular bootstrap时被执行</li>
<li>而<code>{{}}</code>在第一次页面载入时会显示，然后顺便被替换，所以第一次load的时候，可能会看到<code>{{}}</code>显示在页面上</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="ng-cloak"><a href="#ng-cloak" class="headerlink" title="ng-cloak"></a><code>ng-cloak</code></h4><p>由于<code>{{}}</code>第一次load会闪现展示的原因，可以使用<code>ng-cloak</code>去保证所有DOM的元素在angular没有处理完成数据更新之前不会显示在前段，大概实现方式如下：</p>
<ol>
<li>第一次加载<code>ng-cloak</code>时，使用如下的css rule去保证所有的angular里面的DOM不会显示：</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-attr">[ng\:cloak]</span>, <span class="selector-attr">[ng-cloak]</span>, <span class="selector-attr">[data-ng-cloak]</span>, <span class="selector-attr">[x-ng-cloak]</span>, <span class="selector-class">.ng-cloak</span>, <span class="selector-class">.x-ng-cloak</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="More-Directives"><a href="#More-Directives" class="headerlink" title="More Directives"></a>More Directives</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.done</span> &#123;</span></span><br><span class="line"><span class="undefined">            background-color: green;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.pending</span> &#123;</span></span><br><span class="line"><span class="undefined">            background-color: red;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">"note in ctrl.notes"</span> <span class="attr">ng-class</span>=<span class="string">"ctrl.getNoteClass(note.done)"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label"</span>&gt;</span>&#123;&#123; note.label &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"asignee"</span> <span class="attr">ng-show</span>=<span class="string">"note.assignee"</span> <span class="attr">ng-bind</span>=<span class="string">"note.assignee"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    angular.module("notesApp", [])</span></span><br><span class="line"><span class="undefined">            .controller("MainCtrl", [</span></span><br><span class="line"><span class="undefined">                function () &#123;</span></span><br><span class="line"><span class="undefined">                    var self = this;</span></span><br><span class="line"><span class="undefined">                    self.notes = [</span></span><br><span class="line"><span class="undefined">                        &#123;label: 'First Note', done: false, assignee: 'Spears'&#125;,</span></span><br><span class="line"><span class="undefined">                        &#123;label: 'Second Note', done: false&#125;,</span></span><br><span class="line"><span class="undefined">                        &#123;label: 'Done Note', done: true&#125;,</span></span><br><span class="line"><span class="undefined">                        &#123;label: 'FirstNote', done: false, assignee: 'Brad'&#125;</span></span><br><span class="line"><span class="undefined">                    ];</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">                    self.getNoteClass = function (status) &#123;</span></span><br><span class="line"><span class="undefined">                        return &#123;</span></span><br><span class="line"><span class="undefined">                            done: status,</span></span><br><span class="line"><span class="undefined">                            pending: !status</span></span><br><span class="line"><span class="undefined">                        &#125;;</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="ng-show-vs-ng-hide"><a href="#ng-show-vs-ng-hide" class="headerlink" title="ng-show vs ng-hide"></a>ng-show vs ng-hide</h4><ul>
<li><code>ng-show</code> 用来控制HTML元素的显示</li>
<li><code>ng-hide</code> 用来控制HTML元素的隐藏</li>
</ul>
<p>如果传给ng-show的参数为truly，则该HTML的元素会显示，angularJS把一下的全部识别为truly：</p>
<ul>
<li>true</li>
<li>non-empty string</li>
<li>non-zero number</li>
<li>non-null JS object</li>
</ul>
<h4 id="ng-class"><a href="#ng-class" class="headerlink" title="ng-class"></a>ng-class</h4><p>用来给HTML的页面元素增加或者移除CSS，它可以接受string或者object作为参数：</p>
<ul>
<li>如果是字符串，将会简单的应用该string对应的css</li>
<li>如果是object，则会determine每一个对象里的key，然后evalute该key对应的value，如果value是true，则会应用该css，如果为false，则会移除该css</li>
</ul>
<h3 id="ng-repeat-over-object"><a href="#ng-repeat-over-object" class="headerlink" title="ng-repeat over object"></a>ng-repeat over object</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.label</span> &#123;</span></span><br><span class="line"><span class="undefined">            background-color: green;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.author</span> &#123;</span></span><br><span class="line"><span class="undefined">            background-color: purple;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        div &#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#666</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">"(author, note) in ctrl.notes"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label"</span>&gt;</span>&#123;&#123; note.label &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"author"</span> <span class="attr">ng-bind</span>=<span class="string">"author"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    angular.module("notesApp", [])</span></span><br><span class="line"><span class="undefined">            .controller("MainCtrl", [</span></span><br><span class="line"><span class="undefined">                function () &#123;</span></span><br><span class="line"><span class="undefined">                    var self = this;</span></span><br><span class="line"><span class="undefined">                    self.notes = &#123;</span></span><br><span class="line"><span class="undefined">                        Shyam: &#123;</span></span><br><span class="line"><span class="undefined">                            id: 1,</span></span><br><span class="line"><span class="undefined">                            label: 'First Note',</span></span><br><span class="line"><span class="undefined">                            done: false</span></span><br><span class="line"><span class="undefined">                        &#125;,</span></span><br><span class="line"><span class="undefined">                        Misko: &#123;</span></span><br><span class="line"><span class="undefined">                            id: 3,</span></span><br><span class="line"><span class="undefined">                            label: 'Finished third notes',</span></span><br><span class="line"><span class="undefined">                            done: true</span></span><br><span class="line"><span class="undefined">                        &#125;,</span></span><br><span class="line"><span class="undefined">                        Brad: &#123;</span></span><br><span class="line"><span class="undefined">                            id: 2,</span></span><br><span class="line"><span class="undefined">                            label: 'Second Note',</span></span><br><span class="line"><span class="undefined">                            done: false</span></span><br><span class="line"><span class="undefined">                        &#125;</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：这里使用了<code>(key, value)</code>去unpack JS里面的对象，基本的用法跟python一样一样的。</p>
<h3 id="Helper-Variables-in-ng-repeat"><a href="#Helper-Variables-in-ng-repeat" class="headerlink" title="Helper Variables in ng-repeat"></a>Helper Variables in ng-repeat</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">"note in ctrl.notes"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>First Element: &#123;&#123; $first &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Middle Element: &#123;&#123; $middle &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Last Element: &#123;&#123; $last &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Index of Element: &#123;&#123; $index &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>At Even Position: &#123;&#123; $even &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>At Odd Position: &#123;&#123; $odd &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label"</span>&gt;</span>&#123;&#123; note.label &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"status"</span> <span class="attr">ng-bind</span>=<span class="string">"note.done"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    angular.module("notesApp", [])</span></span><br><span class="line"><span class="undefined">            .controller("MainCtrl", [</span></span><br><span class="line"><span class="undefined">                function () &#123;</span></span><br><span class="line"><span class="undefined">                    var self = this;</span></span><br><span class="line"><span class="undefined">                    self.notes = [</span></span><br><span class="line"><span class="undefined">                        &#123;id: 1, label: 'First Note', done: false&#125;,</span></span><br><span class="line"><span class="undefined">                        &#123;id: 2, label: 'Second Note', done: false&#125;,</span></span><br><span class="line"><span class="undefined">                        &#123;id: 3, label: 'Done Note', done: true&#125;,</span></span><br><span class="line"><span class="undefined">                        &#123;id: 4, label: 'Last Note', done: false&#125;</span></span><br><span class="line"><span class="undefined">                    ];</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：基本是一些预定义的<code>FOR-LOOP</code>中的基本中间临时变量</p>
<h3 id="ng-repeat-track-by-id"><a href="#ng-repeat-track-by-id" class="headerlink" title="ng-repeat track by id"></a>ng-repeat track by id</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.changeNote()"</span>&gt;</span>Change Notes<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">DOM Elements change every time some clicks</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">"note in ctrl.note1"</span>&gt;</span></span><br><span class="line">    &#123;&#123; note.$$hashKey &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label"</span>&gt;</span>&#123;&#123; note.label &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"author"</span> <span class="attr">ng-bind</span>=<span class="string">"note.done"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">DOM Elements are reused every time some clicks</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">"note in ctrl.note2 track by note.id"</span>&gt;</span></span><br><span class="line">    &#123;&#123; note.$$hashKey &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"label"</span>&gt;</span>&#123;&#123; note.label &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"status"</span> <span class="attr">ng-bind</span>=<span class="string">"note.done"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    angular.module("notesApp", [])</span></span><br><span class="line"><span class="undefined">            .controller("MainCtrl", [</span></span><br><span class="line"><span class="undefined">                function () &#123;</span></span><br><span class="line"><span class="undefined">                    var self = this;</span></span><br><span class="line"><span class="undefined">                    var notes = [</span></span><br><span class="line"><span class="undefined">                        &#123;</span></span><br><span class="line"><span class="undefined">                            id: 1,</span></span><br><span class="line"><span class="undefined">                            label: 'First Note',</span></span><br><span class="line"><span class="undefined">                            done: false,</span></span><br><span class="line"><span class="undefined">                            someRandom: 31431</span></span><br><span class="line"><span class="undefined">                        &#125;,</span></span><br><span class="line"><span class="undefined">                        &#123;</span></span><br><span class="line"><span class="undefined">                            id: 2,</span></span><br><span class="line"><span class="undefined">                            label: 'Some Note',</span></span><br><span class="line"><span class="undefined">                            done: false</span></span><br><span class="line"><span class="undefined">                        &#125;,</span></span><br><span class="line"><span class="undefined">                        &#123;</span></span><br><span class="line"><span class="undefined">                            id: 3,</span></span><br><span class="line"><span class="undefined">                            label: 'Finished Third Note',</span></span><br><span class="line"><span class="undefined">                            done: true</span></span><br><span class="line"><span class="undefined">                        &#125;</span></span><br><span class="line"><span class="undefined">                    ];</span></span><br><span class="line"><span class="undefined">                    self.note1 = angular.copy(notes);</span></span><br><span class="line"><span class="undefined">                    self.note2 = angular.copy(notes);</span></span><br><span class="line"><span class="undefined">                    self.changeNote = function () &#123;</span></span><br><span class="line"><span class="undefined">                        notes = [</span></span><br><span class="line"><span class="undefined">                            &#123;</span></span><br><span class="line"><span class="undefined">                                id: 1,</span></span><br><span class="line"><span class="undefined">                                label: 'Changed Note',</span></span><br><span class="line"><span class="undefined">                                done: false,</span></span><br><span class="line"><span class="undefined">                                someRandom: 4242</span></span><br><span class="line"><span class="undefined">                            &#125;,</span></span><br><span class="line"><span class="undefined">                            &#123;</span></span><br><span class="line"><span class="undefined">                                id: 2,</span></span><br><span class="line"><span class="undefined">                                label: 'Second Note',</span></span><br><span class="line"><span class="undefined">                                done: false</span></span><br><span class="line"><span class="undefined">                            &#125;,</span></span><br><span class="line"><span class="undefined">                            &#123;</span></span><br><span class="line"><span class="undefined">                                id: 3,</span></span><br><span class="line"><span class="undefined">                                label: 'Finished Third Note',</span></span><br><span class="line"><span class="undefined">                                done: true</span></span><br><span class="line"><span class="undefined">                            &#125;</span></span><br><span class="line"><span class="undefined">                        ];</span></span><br><span class="line"><span class="undefined">                        self.note1 = angular.copy(notes);</span></span><br><span class="line"><span class="undefined">                        self.note2 = angular.copy(notes);</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：ng-repeat在使用模板创建HTML DOM的时候，使用cache技术去重复使用DOM元素对象，如果两个对象的hash值的计算是一样的话，该hash值是有angular计算的，但是具体的算法可以使用<code>track by</code>去覆盖angular使用的hash算法，比如上例中，使用了<code>note.id</code>作为hash的identifer，那么每次ng-repat在iterate对象的时候，都会重用已经创建的DOM元素。</p>
<h3 id="ng-repeat-across-multiple-HTML-elements"><a href="#ng-repeat-across-multiple-HTML-elements" class="headerlink" title="ng-repeat across multiple HTML elements"></a>ng-repeat across multiple HTML elements</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat-start</span>=<span class="string">"note in ctrl.notes"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; note.label &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">ng-repeat-end</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>Done: &#123;&#123; note.done &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    angular.module("notesApp", [])</span></span><br><span class="line"><span class="undefined">            .controller("MainCtrl", [</span></span><br><span class="line"><span class="undefined">                function () &#123;</span></span><br><span class="line"><span class="undefined">                    var self = this;</span></span><br><span class="line"><span class="undefined">                    self.notes = [</span></span><br><span class="line"><span class="undefined">                        &#123;</span></span><br><span class="line"><span class="undefined">                            id: 1,</span></span><br><span class="line"><span class="undefined">                            label: 'First Note',</span></span><br><span class="line"><span class="undefined">                            done: false,</span></span><br><span class="line"><span class="undefined">                            someRandom: 31431</span></span><br><span class="line"><span class="undefined">                        &#125;,</span></span><br><span class="line"><span class="undefined">                        &#123;</span></span><br><span class="line"><span class="undefined">                            id: 2,</span></span><br><span class="line"><span class="undefined">                            label: 'Some Note',</span></span><br><span class="line"><span class="undefined">                            done: false</span></span><br><span class="line"><span class="undefined">                        &#125;,</span></span><br><span class="line"><span class="undefined">                        &#123;</span></span><br><span class="line"><span class="undefined">                            id: 3,</span></span><br><span class="line"><span class="undefined">                            label: 'Finished Third Note',</span></span><br><span class="line"><span class="undefined">                            done: true</span></span><br><span class="line"><span class="undefined">                        &#125;</span></span><br><span class="line"><span class="undefined">                    ];</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：这里使用ng-repeat-start和ng-repeat-end去一个interation生成两个tr，之所以要用这种麻烦的方式是因为，ng-repeat必须声明在HTML的element中，但是这里有2个<code>&lt;tr&gt;</code>是兄弟关系，而不是父子关系，如果要在两个兄弟元素上使用ng-repeat中的本地变量，则必须把ng-repeat安装到父辈的元素上，但是这里不想再table中安装ng-repeat，则可以使用partial ng-repeat，分别安装到两个不同的元素里，这个start和end相当于scope的开始和结束，比如Javascript中的scope开始符号是<code>{</code>，而结束符号是<code>}</code>。</p>
<h3 id="Unit-Test-in-Javascript"><a href="#Unit-Test-in-Javascript" class="headerlink" title="Unit Test in Javascript"></a>Unit Test in Javascript</h3><h4 id="Test-Runner-vs-Test-Framework"><a href="#Test-Runner-vs-Test-Framework" class="headerlink" title="Test Runner vs Test Framework"></a>Test Runner vs Test Framework</h4><p>大部分library提供了2个功能在一起：</p>
<ul>
<li><p>test runner</p>
<ul>
<li>Finding the tests</li>
<li>Open browser to execute the test script</li>
<li>capture the results</li>
</ul>
</li>
<li><p>test framework</p>
<ul>
<li>define the syntax</li>
<li>API</li>
<li>assert</li>
</ul>
</li>
</ul>
<p>Angular中，两个是分开的，使用karma作为test runner，而Jasmine作为test framework。</p>
<h4 id="karma的架构"><a href="#karma的架构" class="headerlink" title="karma的架构"></a>karma的架构</h4><p>karma使用插件方式管理它需要的每个模块，比如我们如果要使用jasmine测试框架，那么我们可以安装<code>npm install karma-jasmine</code>，而如果我们要使用chrome去执行我们的测试脚本，我们可以使用<code>npm install karma-chrome-launcher</code></p>
<h5 id="Karma-Plugins"><a href="#Karma-Plugins" class="headerlink" title="Karma Plugins"></a>Karma Plugins</h5><ul>
<li>Browser launcher</li>
<li>Testing Framework</li>
<li>Reporters</li>
<li>Integrations</li>
</ul>
<h5 id="Karma-Config"><a href="#Karma-Config" class="headerlink" title="Karma Config"></a>Karma Config</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Karma configuration</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    config.set(&#123;</span><br><span class="line">        basePath: <span class="string">''</span>,</span><br><span class="line">        frameworks: [<span class="string">'jasmine'</span>],</span><br><span class="line">        files: [</span><br><span class="line">            <span class="string">'angular.min.js'</span>,</span><br><span class="line">            <span class="string">'angular-mock.js'</span>,</span><br><span class="line">            <span class="string">'controller.js'</span>,</span><br><span class="line">            <span class="string">'simpleSpec.js'</span>,</span><br><span class="line">            <span class="string">'controllerSpec.js'</span></span><br><span class="line">        ],</span><br><span class="line">        excludes: [],</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        logLevel: config.LOG_INFO,</span><br><span class="line">        autoWatch: <span class="literal">true</span>,</span><br><span class="line">        browser: [<span class="string">'Chrome'</span>],</span><br><span class="line">        singleRun: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>可以通过<code>karma init</code>交互式完成karma的配置，最后生成karma.conf.js。</p>
<h5 id="Jasmine：Spec"><a href="#Jasmine：Spec" class="headerlink" title="Jasmine：Spec"></a>Jasmine：Spec</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'Controller: ListCtrl'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(</span><br><span class="line">        <span class="built_in">module</span>(<span class="string">'notesApp'</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ctrl;</span><br><span class="line"></span><br><span class="line">    beforeEach(</span><br><span class="line">        inject(</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">$controller</span>) </span>&#123;</span><br><span class="line">                ctrl = $controller(<span class="string">'ListCtrl'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should have items available on load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        expect(ctrl.items).toEqual(</span><br><span class="line">            [</span><br><span class="line">                &#123;<span class="string">'id'</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'First'</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;,</span><br><span class="line">                &#123;<span class="string">'id'</span>: <span class="number">2</span>, <span class="attr">label</span>: <span class="string">'Second'</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should have highlight items based on state'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> item = &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'First'</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;;</span><br><span class="line">        <span class="keyword">var</span> actualClass = ctrl.getDoneClass(item);</span><br><span class="line">        expect(actualClass.finished).toBeTruthy();</span><br><span class="line">        expect(actualClass.unfinished).toBeFalsy();</span><br><span class="line"></span><br><span class="line">        item.done = <span class="literal">false</span>;</span><br><span class="line">        actualClass = ctrl.getDoneClass(item);</span><br><span class="line">        expect(actualClass.finished).toBeFalsy();</span><br><span class="line">        expect(actualClass.unfinished).toBeTruthy();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Angular-Service"><a href="#Angular-Service" class="headerlink" title="Angular Service"></a>Angular Service</h3><ul>
<li>one-way data binding<ul>
<li><code>{{}}</code> notation</li>
<li>ng-bind directive</li>
</ul>
</li>
<li>two-way data binding<ul>
<li>ng-model</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.username"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">You typed &#123;&#123;ctrl.username&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'notesApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'MainCtrl'</span>, [</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.username = <span class="string">'nothing'</span>;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>这里使用了ng-model directive</li>
<li>如果要更新UI里面的值，只需要更新controller里的值</li>
</ul>
<p>稍微复杂点的例子：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.username"</span> <span class="attr">title</span>=<span class="string">"Username"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.password"</span> <span class="attr">title</span>=<span class="string">"Password"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.change()"</span>&gt;</span>Change Value<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.submit()"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'notesApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'MainCtrl'</span>, [</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">                    self.change = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        self.username = <span class="string">'changed'</span>;</span></span><br><span class="line"><span class="javascript">                        self.password = <span class="string">'password'</span>;</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="javascript">                    self.submit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'User clicked submit with'</span>, self.username, self.password);</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：这里我们更加能够详细看清楚UI的更新实际是全在controller中间完成的，通过controller更新model里面的值，而具体更新的执行时不需要用户参与的，用户只关心model。</p>
<h4 id="Forms"><a href="#Forms" class="headerlink" title="Forms"></a>Forms</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-submit</span>=<span class="string">"ctrl.submit()"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.user.username"</span> <span class="attr">title</span>=<span class="string">"User Name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.user.password"</span> <span class="attr">title</span>=<span class="string">"User Password"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'notesApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'MainCtrl'</span>, [</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">                    self.submit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'User clicked submit with'</span>, self.user);</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>使用了ng-submit directive在form标签里</li>
<li>controller里面不存在的对象，由angular在需要时动态创建</li>
</ul>
<h4 id="Form-Validation-and-States"><a href="#Form-Validation-and-States" class="headerlink" title="Form Validation and States"></a>Form Validation and States</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-submit</span>=<span class="string">"ctrl.submit()"</span> <span class="attr">name</span>=<span class="string">"myForm"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.user.username"</span> <span class="attr">title</span>=<span class="string">"User Name"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">required</span></span></span><br><span class="line"><span class="tag">           <span class="attr">ng-minlength</span>=<span class="string">"4"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.user.password"</span> <span class="attr">title</span>=<span class="string">"User Password"</span> <span class="attr">required</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span> <span class="attr">ng-disabled</span>=<span class="string">"myForm.$invalid"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'notesApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'MainCtrl'</span>, [</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">                    self.submit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'User clicked submit with'</span>, self.user);</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>引用了一个form的名字“myForm”</li>
<li>HTML5的validation tag，<code>required</code></li>
<li>validator: <code>ng-minlength</code></li>
<li>ng-disabled directive，基于后面的参数（<code>form state</code>）的返回值</li>
</ul>
<h5 id="Form-State"><a href="#Form-State" class="headerlink" title="Form State"></a>Form State</h5><ul>
<li>$invalid</li>
<li>$valid</li>
<li>$pristine，angular的初始状态，用以判定用户是否有输入动作</li>
<li>$dirty，$pristine反向，用户已经修改了某些状态，但是没有提交</li>
<li>$error</li>
</ul>
<h5 id="Built-in-validators"><a href="#Built-in-validators" class="headerlink" title="Built-in validators"></a>Built-in validators</h5><ul>
<li>required</li>
<li>ng-required，后面跟参数可以动态required</li>
<li>ng-minlength</li>
<li>ng-maxlength</li>
<li>ng-pattern</li>
<li>type=<code>&quot;email&quot;</code></li>
<li>type=<code>&quot;date&quot;</code></li>
<li>type=<code>&quot;url&quot;</code></li>
</ul>
<h5 id="Display-Error-Message"><a href="#Display-Error-Message" class="headerlink" title="Display Error Message"></a>Display Error Message</h5><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        input &#123;</span></span><br><span class="line"><span class="undefined">            display: block;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-submit</span>=<span class="string">"ctrl.submit()"</span> <span class="attr">name</span>=<span class="string">"myForm"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">ng-model</span>=<span class="string">"ctrl.user.username"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">title</span>=<span class="string">"User Name"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">name</span>=<span class="string">"uname"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">required</span></span></span><br><span class="line"><span class="tag">           <span class="attr">ng-minlength</span>=<span class="string">"4"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;span ng-show="myForm.uname.$error.required"&gt;This is required field&lt;/span&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">"myForm.uname.$error.required"</span>&gt;</span></span><br><span class="line"> This is a required field</span><br><span class="line"> <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">"myForm.uname.$error.minlength"</span>&gt;</span>Minimum length required is 4<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">"myForm.uname.$invalid"</span>&gt;</span>This field is invalid<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">ng-model</span>=<span class="string">"ctrl.user.password"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">title</span>=<span class="string">"User Password"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">required</span></span></span><br><span class="line"><span class="tag">           <span class="attr">name</span>=<span class="string">"pwd"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">"myForm.pwd.$error.required"</span>&gt;</span>This is required field<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span> <span class="attr">ng-disabled</span>=<span class="string">"myForm.$invalid"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'notesApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'MainCtrl'</span>, [</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">                    self.submit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'User clicked submit with'</span>, self.user);</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>使用了ng-show directive</li>
<li>ng-show directive用来显示DOM基于后面的参数的返回值，其他跟前面是一样样的</li>
</ul>
<h5 id="Form-Styling-and-States"><a href="#Form-Styling-and-States" class="headerlink" title="Form Styling and States"></a>Form Styling and States</h5><table>
<thead>
<tr>
<th style="text-align:left">state</th>
<th style="text-align:left">css</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">$invalid</td>
<td style="text-align:left">ng-invalid</td>
</tr>
<tr>
<td style="text-align:left">$valid</td>
<td style="text-align:left">ng-valid</td>
</tr>
<tr>
<td style="text-align:left">$pristine</td>
<td style="text-align:left">ng-pristine</td>
</tr>
<tr>
<td style="text-align:left">$dirty</td>
<td style="text-align:left">ng-dirty</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">state</th>
<th style="text-align:left">css</th>
<th style="text-align:left">invalid css</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">required</td>
<td style="text-align:left">ng-valid-required</td>
<td style="text-align:left">ng-invalid-required</td>
</tr>
<tr>
<td style="text-align:left">min</td>
<td style="text-align:left">ng-valid-min</td>
<td style="text-align:left">ng-invalid-min</td>
</tr>
<tr>
<td style="text-align:left">max</td>
<td style="text-align:left">ng-valid-max</td>
<td style="text-align:left">ng-valid-max</td>
</tr>
<tr>
<td style="text-align:left">minlength</td>
<td style="text-align:left">ng-valid-minlength</td>
<td style="text-align:left">ng-invalid-minlength</td>
</tr>
<tr>
<td style="text-align:left">maxlength</td>
<td style="text-align:left">ng-valid-maxlength</td>
<td style="text-align:left">ng-invalid-maxlength</td>
</tr>
<tr>
<td style="text-align:left">pattern</td>
<td style="text-align:left">ng-valid-pattern</td>
<td style="text-align:left">ng-invalid-pattern</td>
</tr>
<tr>
<td style="text-align:left">url</td>
<td style="text-align:left">ng-valid-url</td>
<td style="text-align:left">ng-invalid-url</td>
</tr>
<tr>
<td style="text-align:left">email</td>
<td style="text-align:left">ng-email-valid</td>
<td style="text-align:left">ng-invalid-email</td>
</tr>
<tr>
<td style="text-align:left">date</td>
<td style="text-align:left">ng-date-valid</td>
<td style="text-align:left">ng-invalid-date</td>
</tr>
<tr>
<td style="text-align:left">number</td>
<td style="text-align:left">ng-number-valid</td>
<td style="text-align:left">ng-invalid-number</td>
</tr>
</tbody>
</table>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        input &#123;</span></span><br><span class="line"><span class="undefined">            display: block;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.username</span><span class="selector-class">.ng-valid</span> &#123;</span></span><br><span class="line"><span class="undefined">            background-color: green;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.username</span><span class="selector-class">.ng-dirty</span><span class="selector-class">.ng-invalid-required</span> &#123;</span></span><br><span class="line"><span class="undefined">            background-color: red;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.username</span><span class="selector-class">.ng-dirty</span><span class="selector-class">.ng-invalid-minlength</span> &#123;</span></span><br><span class="line"><span class="undefined">            background-color: lightpink;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-submit</span>=<span class="string">"ctrl.submit()"</span> <span class="attr">name</span>=<span class="string">"myForm"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">ng-model</span>=<span class="string">"ctrl.user.username"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">title</span>=<span class="string">"User Name"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">name</span>=<span class="string">"uname"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">class</span>=<span class="string">"username"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">required</span></span></span><br><span class="line"><span class="tag">           <span class="attr">ng-minlength</span>=<span class="string">"4"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;span ng-show="myForm.uname.$error.required"&gt;This is required field&lt;/span&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">"myForm.uname.$error.required"</span>&gt;</span></span><br><span class="line"> This is a required field</span><br><span class="line"> <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">"myForm.uname.$error.minlength"</span>&gt;</span>Minimum length required is 4<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">"myForm.uname.$invalid"</span>&gt;</span>This field is invalid<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">ng-model</span>=<span class="string">"ctrl.user.password"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">title</span>=<span class="string">"User Password"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">required</span></span></span><br><span class="line"><span class="tag">           <span class="attr">name</span>=<span class="string">"pwd"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">"myForm.pwd.$error.required"</span>&gt;</span>This is required field<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span> <span class="attr">ng-disabled</span>=<span class="string">"myForm.$invalid"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'notesApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'MainCtrl'</span>, [</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">                    self.submit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'User clicked submit with'</span>, self.user);</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<p>这里对input标签增加了class，然后在style块中定义具体的与ng的state有关的次级样式，很简单</p>
<h4 id="Nested-Forms"><a href="#Nested-Forms" class="headerlink" title="Nested Forms"></a>Nested Forms</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ng-submit</span>=<span class="string">"ctrl.submit()"</span> <span class="attr">name</span>=<span class="string">"myForm"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">ng-model</span>=<span class="string">"ctrl.user.username"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">placeholder</span>=<span class="string">"User Name"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">name</span>=<span class="string">"uname"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">class</span>=<span class="string">"username"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">required</span></span></span><br><span class="line"><span class="tag">           <span class="attr">ng-minlength</span>=<span class="string">"4"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">ng-model</span>=<span class="string">"ctrl.user.password"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">title</span>=<span class="string">"User Password"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">class</span>=<span class="string">"password"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">required</span></span></span><br><span class="line"><span class="tag">           <span class="attr">name</span>=<span class="string">"pwd"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ng-form</span> <span class="attr">name</span>=<span class="string">"profile"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">name</span>=<span class="string">"firstName"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">ng-model</span>=<span class="string">"ctrl.user.profile.firstName"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">placeholder</span>=<span class="string">"First Name"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">name</span>=<span class="string">"middleName"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">ng-model</span>=<span class="string">"ctrl.user.profile.middleName"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">placeholder</span>=<span class="string">"Middle Name"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">name</span>=<span class="string">"lastName"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">ng-model</span>=<span class="string">"ctrl.user.profile.lastName"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">placeholder</span>=<span class="string">"Last Name"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"date"</span> <span class="attr">name</span>=<span class="string">"dob"</span> <span class="attr">placeholder</span>=<span class="string">"Date of Birth"</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.user.profile.lastName"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ng-form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-show</span>=<span class="string">"myForm.profile.$invalid"</span>&gt;</span></span><br><span class="line">        Please fill out the profile information</span><br><span class="line">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span> <span class="attr">ng-disabled</span>=<span class="string">"myForm.$invalid"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'notesApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'MainCtrl'</span>, [</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">                    self.submit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">'User clicked submit with'</span>, self.user);</span></span><br><span class="line"><span class="undefined">                    &#125;;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：这里使用了<code>ng-form</code> directive，后面的validator的验证是基于内嵌的form整体的state</p>
<h4 id="Other-Form-Controls"><a href="#Other-Form-Controls" class="headerlink" title="Other Form Controls"></a>Other Form Controls</h4><ul>
<li><p>TextArea</p>
<ul>
<li><code>&lt;textarea ng-model=&quot;ctrl.user.address&quot; required&gt;&lt;/textarea&gt;</code></li>
</ul>
</li>
<li><p>CheckBox</p>
<ul>
<li><code>&lt;input type=&quot;checkbox&quot; ng-model=&quot;ctrl.user.agree&quot;&gt;</code></li>
<li><code>&lt;input type=&quot;checkbox&quot; ng-model=&quot;ctrl.user.agree&quot; ng-true-value=&quot;YES&quot; ng-false-value=&quot;NO&quot;&gt;</code></li>
</ul>
</li>
<li><p>RadioButton</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-init</span>=<span class="string">"user = &#123;gender: 'female'&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">"gender"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ng-model</span>=<span class="string">"user.gener"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">"male"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">"gender"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ng-model</span>=<span class="string">"user.gender"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">"female"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析： 这里就是使用传统的HTML对radiobutton的处理方法</p>
<p>如果我们要想使用dynamic的raidobutton值，那么可以使用：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name</span>=<span class="string">"gender"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ng-model</span>=<span class="string">"user.gender"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ng-value</span>=<span class="string">"otherGender"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：这里使用了ng-value directive，对应的值是angular的expression，可以从controller中拿到，然后用在radiobutton的值中</p>
<ul>
<li>Combo Box vs Dropdown</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-init</span>=<span class="string">"location = 'India'"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">ng-model</span>=<span class="string">"location"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"USA"</span>&gt;</span>USA<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"India"</span>&gt;</span>India<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"Other"</span>&gt;</span>None of the above<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：没有特别之处，就是传统的HTML</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as ctrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.selectedCountryId"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ng-options</span>=<span class="string">"c.id as c.label for c in ctrl.countries"</span> <span class="attr">title</span>=<span class="string">"country ID"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    Selected Country ID: &#123;&#123;ctrl.selectedCountryId&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.selectedCountry"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ng-options</span>=<span class="string">"c.label for c in ctrl.countries"</span> <span class="attr">title</span>=<span class="string">"country"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    Selected Country: &#123;&#123;ctrl.selectedCountry.label&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">"notesApp"</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">"MainCtrl"</span>, [</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.countries = [</span></span><br><span class="line"><span class="javascript">                        &#123;<span class="attr">label</span>: <span class="string">'USA'</span>, <span class="attr">id</span>: <span class="number">1</span>&#125;,</span></span><br><span class="line"><span class="javascript">                        &#123;<span class="attr">label</span>: <span class="string">'India'</span>, <span class="attr">id</span>: <span class="number">2</span>&#125;,</span></span><br><span class="line"><span class="javascript">                        &#123;<span class="attr">label</span>: <span class="string">'Other'</span>, <span class="attr">id</span>: <span class="number">3</span>&#125;</span></span><br><span class="line"><span class="undefined">                    ];</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.selectedCountryId = <span class="number">2</span>;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.selectedCountry = <span class="keyword">this</span>.countries[<span class="number">1</span>];</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：使用了动态的值去填充selection options，这里的取值方法类似于ng-repeat或者python中的unpack expression。有一个特别的地方是<code>c.id as c.label</code>，这里的意思是显示在UI中的值是<code>c.label</code>，而实际存储的值是<code>c.id</code></p>
<h3 id="Services"><a href="#Services" class="headerlink" title="Services"></a>Services</h3><ul>
<li>Angular Service 是javascript对象或者function</li>
<li>Angular Service提供跨应用的状态和行为</li>
<li>Angular Service只会被初始化一次，单例的</li>
<li>主要提供的功能包括：<ul>
<li>repeated behaviour</li>
<li>shared state</li>
<li>cache</li>
<li>factories</li>
<li>provider</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="comment">&lt;!--suppress HtmlUnknownTarget --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Notes App<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as mainCtrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello controllers!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"mainCtrl.open('first')"</span>&gt;</span>Open First<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"mainCtrl.open('second')"</span>&gt;</span>Open Second<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-switch</span> <span class="attr">on</span>=<span class="string">"mainCtrl.tab"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-switch-when</span>=<span class="string">"first"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"SubCtrl as ctrl"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>First Tab<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"item in ctrl.list"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"item.label"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.add()"</span>&gt;</span>Add More Items<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-switch-when</span>=<span class="string">"second"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"SubCtrl as ctrl"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Second Tab<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"item in ctrl.list"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"item.label"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.add()"</span>&gt;</span>Add More Items<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>一个新的angular directive，<code>ng-switch</code>和<code>ng-switch-when</code><ul>
<li>类似于通常编程语言的switch遍历结构</li>
</ul>
</li>
<li>使用了2个controller，一个scope实在body元素里，而另外一个子controller是在一个div元素里，负责item的展示与增添</li>
<li>由于两个div初始化了2个不同的controller，所以这里每次切换tab时，原来的数据都会丢失，因为controller对象是不同的</li>
</ul>
<h4 id="Services-vs-Controller"><a href="#Services-vs-Controller" class="headerlink" title="Services vs Controller"></a>Services vs Controller</h4><p>angular里面的service跟通常意义上的service不同，angular的service包括factories、services和providers。</p>
<table>
<thead>
<tr>
<th style="text-align:left">controller</th>
<th style="text-align:left">Service</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Presentation Logic</td>
<td style="text-align:left">Business Logic</td>
</tr>
<tr>
<td style="text-align:left">Directly linked to a view</td>
<td style="text-align:left">Independent of View</td>
</tr>
<tr>
<td style="text-align:left">Driver the UI</td>
<td style="text-align:left">Drive the application</td>
</tr>
<tr>
<td style="text-align:left">One-off,specific</td>
<td style="text-align:left">Reusable</td>
</tr>
<tr>
<td style="text-align:left">Responsible for decisions like what data to fetch, what data to show, how to handle user interaction, and styling and display of UI</td>
<td style="text-align:left">Responsible for making server call, common validation logic, application-level stores, and reusable business logic</td>
</tr>
</tbody>
</table>
<h4 id="Dependency-Injection-in-AngularJS"><a href="#Dependency-Injection-in-AngularJS" class="headerlink" title="Dependency Injection in AngularJS"></a>Dependency Injection in AngularJS</h4><p>Without dependency injection:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchDashboardData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $http = <span class="keyword">new</span> HttpService();</span><br><span class="line">    <span class="keyword">return</span> $http.get(<span class="string">'my/url'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>With dependency injection:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetchDashboardData</span>(<span class="params">$http</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $http.get(<span class="string">'my/url'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>依赖注射的一个重要的准则就是：依赖的初始化是由自己负责还是外部负责</p>
<p>angular的DI机制保证：</p>
<ul>
<li>我们提供给service declaration的function只会被执行一次（lazily）</li>
<li>angular service在整个application的scope内都是单例的（signleton）</li>
<li>两个不同的service或者controller请求serviceA时，将会永远得到同样的实例</li>
</ul>
<h4 id="Built-in-AngularJS-Service"><a href="#Built-in-AngularJS-Service" class="headerlink" title="Built in AngularJS Service"></a>Built in AngularJS Service</h4><p>angular自己提供的一个命名规范：</p>
<ul>
<li>所有built-in的angular service都会以$开头</li>
<li>用户自定义的service不要用$开头</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as mainCtrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Service<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"mainCtrl.logStuff()"</span>&gt;</span>Log Something<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">"notesApp"</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">"MainCtrl"</span>, [<span class="string">'$log'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$log</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> self = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">                self.logStuff = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    $log.log(<span class="string">"The button was pressed!"</span>);</span></span><br><span class="line"><span class="undefined">                &#125;;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">            ]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>这里的controller使用了依赖，放在<code>controller(&quot;controllerName&quot;, [...,function])</code>中</li>
<li>注入的service是<code>&quot;$log&quot;</code>，是一个字符串，然后angular将根据该字符串，寻找对应的service并初始化</li>
<li>后面function在argument中引用了注入的service，<code>$log</code></li>
<li>function中引入的<code>$log</code>，可以不用在controller的dependencies中声明，而直接在function中声明时，angular也能够通过DI找到对应的正确的服务，但是这里的问题是，当使用一些<code>minifyjavascript</code>服务时，所有的javascript的变量可能被截断，如果<code>$log</code>被截断，则angular就不能有效找到真正需要的<code>$log</code>服务</li>
</ul>
<h5 id="Order-of-Injection"><a href="#Order-of-Injection" class="headerlink" title="Order of Injection"></a>Order of Injection</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">myModule.controller(<span class="string">"MainCtrl"</span>,</span><br><span class="line">    [<span class="string">"$log"</span>, <span class="string">"$window"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$l, $w</span>) </span>&#123;&#125;]);</span><br></pre></td></tr></table></figure>
<ul>
<li>这里的<code>$l`</code>$w`是与前面的依赖的注射的模块的顺序有关的</li>
<li>funtion的arguments[0]，代表的是第0个注入的模块，arguments[1]，代表的是第1个注入的模块</li>
</ul>
<h5 id="Common-AngularJS-Services"><a href="#Common-AngularJS-Services" class="headerlink" title="Common AngularJS Services"></a>Common AngularJS Services</h5><ul>
<li><p>$window</p>
<ul>
<li>global window object wrapper</li>
</ul>
</li>
<li><p>$location</p>
<ul>
<li>interact with URL<ul>
<li>absUrl, <code>$location.absUrl()</code></li>
<li>url, getter and setter of URL</li>
<li>path, getter and setter the path of URL</li>
<li>search<ul>
<li>$loaction.search()</li>
<li>$location.search(“test”), remove</li>
<li>$location.search(“test”, “abc”), setter of parameter</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>$http</p>
<ul>
<li>XHR, AJAX</li>
</ul>
</li>
</ul>
<h4 id="Create-an-Own-AngularJS-Service"><a href="#Create-an-Own-AngularJS-Service" class="headerlink" title="Create an Own AngularJS Service"></a>Create an Own AngularJS Service</h4><p>AngularJS service criteria:</p>
<ul>
<li>It needs to be reusable</li>
<li>Application level state</li>
<li>It is independent of the View</li>
<li>It integrates with 3rd service</li>
<li>Caching/factories</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as mainCtrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Controllers<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"mainCtrl.open('first')"</span>&gt;</span>Open First<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"mainCtrl.open('second')"</span>&gt;</span>Open Second<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-switch</span> <span class="attr">on</span>=<span class="string">"mainCtrl.tab"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-switch-when</span>=<span class="string">"first"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"SubCtrl as ctrl"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>First Tab<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"item in ctrl.list()"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"item.label"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.add()"</span>&gt;</span>Add More Items<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-switch-when</span>=<span class="string">"second"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"SubCtrl as ctrl"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Second Tab<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"item in ctrl.list()"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"item.label"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.add()"</span>&gt;</span>Add More Items<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"app.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">```                                  </span><br><span class="line"></span><br><span class="line">app.js</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">angular.module("notesApp", [])</span><br><span class="line">    .controller("MainCtrl", [</span><br><span class="line">        function () &#123;</span><br><span class="line">            var self = this;</span><br><span class="line">            self.tab = "first";</span><br><span class="line">            self.open = function (tab) &#123;</span><br><span class="line">                self.tab = tab;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    ])</span><br><span class="line">    .controller("SubCtrl", ['ItemService', function (ItemService) &#123;</span><br><span class="line">        var self = this;</span><br><span class="line">        self.list = function () &#123;</span><br><span class="line">            return ItemService.list();</span><br><span class="line">        &#125;;</span><br><span class="line">        self.add = function () &#123;</span><br><span class="line">            ItemService.add(&#123;</span><br><span class="line">                id: self.list().length + 1,</span><br><span class="line">                label: 'Item ' + self.list().length</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;])</span><br><span class="line">    .factory("ItemService", [</span><br><span class="line">        function () &#123;</span><br><span class="line">            var items = [</span><br><span class="line">                &#123;id: 1, label: 'Item 0'&#125;,</span><br><span class="line">                &#123;id: 2, label: 'Item 1'&#125;</span><br><span class="line">            ];</span><br><span class="line"></span><br><span class="line">            return &#123;</span><br><span class="line">                list: function () &#123;</span><br><span class="line">                    return items;</span><br><span class="line">                &#125;,</span><br><span class="line">                add: function (item) &#123;</span><br><span class="line">                    items.push(item);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>使用angular.module().factory去声明service的名字和dependencies</li>
<li>具体的实现是放在<code>[..., function]</code>的function中，与controller的函数签名类似</li>
<li>返回的是一个object或者function，这个对象或者函数变成了service的public API</li>
</ul>
<p>angular保证：</p>
<ul>
<li>service将会被lazily初始化一次</li>
<li>service是单例的（singleton）</li>
</ul>
<h3 id="Difference-between-Factory-Service-and-Provider"><a href="#Difference-between-Factory-Service-and-Provider" class="headerlink" title="Difference between Factory, Service, and Provider"></a>Difference between Factory, Service, and Provider</h3><p>当遇到以下情况时使用factory：</p>
<ul>
<li>follow function style of programming</li>
<li>prefer to return function or object</li>
</ul>
<p>以下情况可以使用service：</p>
<ul>
<li>follow OO style programming</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ItemService</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> items = [</span><br><span class="line">        &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Item 0'</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">label</span>: <span class="string">'Item 1'</span>&#125;</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">this</span>.list = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">this</span>.add = <span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">        items.push(item);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">angular.module(<span class="string">"notesApp"</span>, [])</span><br><span class="line">    .service(<span class="string">'ItemService'</span>, [ItemService])</span><br><span class="line">    .controller(<span class="string">"MainCtrl"</span>, [</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">            self.tab = <span class="string">"first"</span>;</span><br><span class="line">            self.open = <span class="function"><span class="keyword">function</span> (<span class="params">tab</span>) </span>&#123;</span><br><span class="line">                self.tab = tab;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    ])</span><br><span class="line">    .controller(<span class="string">"SubCtrl"</span>, [<span class="string">'ItemService'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ItemService</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">        self.list = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ItemService.list();</span><br><span class="line">        &#125;;</span><br><span class="line">        self.add = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            ItemService.add(&#123;</span><br><span class="line">                id: self.list().length + <span class="number">1</span>,</span><br><span class="line">                label: <span class="string">'Item '</span> + self.list().length</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>与factory在格式上差不多</li>
<li>具体的实现也是放在<code>[..., function]</code>的function中</li>
<li>不需要return function或者object</li>
<li>angular DI在初始化service时，使用了<code>new</code>关键词，用来把<code>this</code>绑定给初始化后的实例，所以这里不用<code>self=this</code>去closure中传递正确的context</li>
</ul>
<p>以下情况使用provider：</p>
<ul>
<li>set up some configuration for our service before application loads</li>
<li>have function to be called to set up how our service works based on the language, environment, or other things</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ItemService</span>(<span class="params">opt_items</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> items = opt_items || [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.list = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.add = <span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">        items.push(item);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">angular.module(<span class="string">"notesApp"</span>, [])</span><br><span class="line">    .provider(<span class="string">'ItemService'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> haveDefaultItems = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.disableDefaultItems = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            haveDefaultItems = <span class="literal">false</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.$<span class="keyword">get</span> = [function () &#123;</span><br><span class="line">            <span class="keyword">var</span> optItems = [];</span><br><span class="line">            <span class="keyword">if</span> (haveDefaultItems) &#123;</span><br><span class="line">                optItems = [</span><br><span class="line">                    &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Item 0'</span>&#125;,</span><br><span class="line">                    &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">label</span>: <span class="string">'Item 1'</span>&#125;</span><br><span class="line">                ];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ItemService(optItems);</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;)</span><br><span class="line">    .config([<span class="string">'ItemServiceProvider'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ItemServiceProvider</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> shouldHaveDefaults = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!shouldHaveDefaults) &#123;</span><br><span class="line">            ItemServiceProvider.disableDefaultItems();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;])</span><br><span class="line">    .controller(<span class="string">"MainCtrl"</span>, [</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">            self.tab = <span class="string">"first"</span>;</span><br><span class="line">            self.open = <span class="function"><span class="keyword">function</span> (<span class="params">tab</span>) </span>&#123;</span><br><span class="line">                self.tab = tab;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    ])</span><br><span class="line">    .controller(<span class="string">"SubCtrl"</span>, [<span class="string">'ItemService'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ItemService</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">        self.list = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> ItemService.list();</span><br><span class="line">        &#125;;</span><br><span class="line">        self.add = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            ItemService.add(&#123;</span><br><span class="line">                id: self.list().length + <span class="number">1</span>,</span><br><span class="line">                label: <span class="string">'Item '</span> + self.list().length</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li><code>provider(..., [])</code>的函数签名跟service/factory是一样的</li>
<li><code>config</code>通过provider提供的public API对<code>provider</code>进一步配置</li>
<li>后边controller对provider的引用跟其他factory/service一样</li>
</ul>
<h3 id="Server-communication-via-http"><a href="#Server-communication-via-http" class="headerlink" title="Server communication via $http"></a>Server communication via $http</h3><p>传统的未封装的AJAX：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"></span><br><span class="line">xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.readystate == <span class="number">4</span> &amp;&amp; xmlhttp.status == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> response = xmlhttp.responseText;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (xmlhttp.status == <span class="number">400</span>) &#123;</span><br><span class="line">        <span class="comment">//handle error</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xmlhttp.open(<span class="string">"GET"</span>, <span class="string">"http://myserver/api"</span>, <span class="literal">true</span>);</span><br><span class="line">xmlhttp.send();</span><br><span class="line"><span class="string">``</span><span class="string">`                    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">关于$http</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- core angular service</span></span><br><span class="line"><span class="string">- communicate with server endpoints via XHR</span></span><br><span class="line"><span class="string">- Promise interface</span></span><br><span class="line"><span class="string">    - 保证异步的请求的response一定会被处理</span></span><br><span class="line"><span class="string">    - 允许promise consumer使用一种可预测的方式使用response</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ngResource模块</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">angular.module(<span class="string">'resourceApp'</span>, [<span class="string">'ngResource'</span>])</span><br><span class="line">    .factory(<span class="string">'ProjectService'</span>, [<span class="string">'$resource'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$resource</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $resource(<span class="string">'/api/project/:id'</span>);</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<ul>
<li>调用ProjectService</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">ProjectService.query();</span><br><span class="line">ProjectService.save(&#123;<span class="attr">id</span>: <span class="number">15</span>&#125;, projectObj);</span><br><span class="line">ProjectService.get(&#123;<span class="attr">id</span>: <span class="number">19</span>&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>$http get example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">        <span class="selector-class">.item</span> &#123;</span></span><br><span class="line"><span class="undefined">            padding: 10px;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as mainCtrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Server<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">"todo in mainCtrl.items"</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"todo.label"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>- by <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"todo.author"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'notesApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">"MainCtrl"</span>, [<span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$http</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> self = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="undefined">                self.items = [];</span></span><br><span class="line"><span class="javascript">                $http.get(<span class="string">'http://localhost:8000/api/note'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">                    self.items = response.data;</span></span><br><span class="line"><span class="javascript">                &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">errResponse</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.error(<span class="string">'Error while fetching notes'</span>);</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">            &#125;]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>controller依赖了$http</li>
<li>use promise interface<ul>
<li>successful handler</li>
<li>error handler</li>
</ul>
</li>
<li>response data:<ul>
<li>headers</li>
<li>status</li>
<li>config</li>
<li>data</li>
</ul>
</li>
</ul>
<h3 id="Quick-Promise-interface"><a href="#Quick-Promise-interface" class="headerlink" title="Quick Promise interface"></a>Quick Promise interface</h3><ul>
<li>angularJS are based on <code>Kris Kowal&#39;s Q proposal</code></li>
<li>传统的javascript支持异步的方式是使用无穷嵌套的callbacks</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">xhrGET(<span class="string">'/api/server-config'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">    xhrGET(<span class="string">'/api/'</span> + config.USER_END_POINT, <span class="function"><span class="keyword">function</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">        xhrGET(<span class="string">'/api/'</span> + user.id + <span class="string">'/items'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">items</span>) </span>&#123;</span><br><span class="line">            <span class="comment">//display the items here</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p> The promise API design proposal:</p>
<ul>
<li>each asynchronous task will return a promise object</li>
<li>each promise object have a then function which can take two handler(success, fail)</li>
<li>success and fail handler will be called only once after the asynchronouse task finished</li>
<li><code>then</code> return a promise which can be chained together</li>
<li>each (success/fail) handler can return a value, which will be passed to next function in the chain</li>
<li><p>if handler return a promise (make another asynchronouse request), then the next handler will be called only after the previouse request is finished</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$http.get(<span class="string">'api/server-config'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">configResponse</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $http.get(<span class="string">'/api/'</span> + configResponse.data.USER_END_POINT);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">userResponse</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $http.get(<span class="string">'/api/'</span> + userResponse.data.id + <span class="string">'/items'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">itemResponse</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//display the items here</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//error handling</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Angular-Propagating-Success-and-Error"><a href="#Angular-Propagating-Success-and-Error" class="headerlink" title="Angular Propagating Success and Error"></a>Angular Propagating Success and Error</h3><p>假设下面的假想的promise chain:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">xhrCall()</span><br><span class="line">    .then(S1, E1)</span><br><span class="line">    .then(S2, E2)</span><br><span class="line">    .then(S3, E3)</span><br><span class="line"><span class="string">``</span><span class="string">`    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">如果是happy path，那么正确的handler的执行顺序是：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">S1 -&gt; S2 -&gt; S3</span><br></pre></td></tr></table></figure>
<p>Angular基于前面的handler的返回值，决定下一步要执行的handler，因为所有的handler都是由开发者所写，所以可以通过handler的返回值控制下一个handler的执行</p>
<ul>
<li><p>如果我们想trigger下一个promise的success handler，那么我们可以从当前的success handler或者error handler中返回一个值，然后Angular就会认为前面的promise已经完整地处理了error</p>
</li>
<li><p>如果我们想trigger下一个promise的error handler，我们可以使用<code>$q</code>service。</p>
<ul>
<li>需要注册$q为我们的controller或者service的依赖</li>
<li>然后在前一个的handler之一中，返回<code>$q.reject(data)</code>     </li>
</ul>
</li>
</ul>
<h4 id="q-service"><a href="#q-service" class="headerlink" title="$q service"></a>$q service</h4><ul>
<li><p>$q.defer()</p>
<ul>
<li>创建一个deferred对象，该deffered对象有一个promise属性，可以用来返回一个promise</li>
</ul>
</li>
<li><p>deferredObject.resolve</p>
<ul>
<li>defferred对象可以被resolve（解析），通过在success handler利用传入的argument.resolve()</li>
</ul>
</li>
<li><p>deferredObject.reject</p>
<ul>
<li>defferred对象可以被reject（拒绝），然后传入到error handler中去</li>
</ul>
</li>
<li><p>$q.reject</p>
<ul>
<li>可以在error 或者 success的handler中调用，拥有一个可选的参数，该参数是promise chain中的返回的数据，返回值可以保证下一个promise一定会触发error handler</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">ng-app</span>=<span class="string">"notesApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-controller</span>=<span class="string">"MainCtrl as mainCtrl"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Server<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">'todo in mainCtrl.items'</span> <span class="attr">class</span>=<span class="string">'item'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"todo.label"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>- by <span class="tag">&lt;<span class="name">span</span> <span class="attr">ng-bind</span>=<span class="string">"todo.author"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"addForm"</span> <span class="attr">ng-submit</span>=<span class="string">"mainCtrl.add()"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">placeholder</span>=<span class="string">"Label"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">ng-model</span>=<span class="string">"mainCtrl.newTodo.label"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">required</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">placeholder</span>=<span class="string">"Author"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">ng-model</span>=<span class="string">"mainCtrl.newTodo.author"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">required</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">value</span>=<span class="string">"Add"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">ng-disabled</span>=<span class="string">"addForm.$invalid"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">"notesApp"</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">"MainCtrl"</span>, [<span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$http</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> self = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="undefined">                self.items = [];</span></span><br><span class="line"><span class="undefined">                self.newTodo = &#123;&#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> fetchTodos = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> $http.get(<span class="string">'http://localhost:8000/api/note'</span>).then(</span></span><br><span class="line"><span class="javascript">                            <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">                                self.items = response.data;</span></span><br><span class="line"><span class="undefined">                            &#125;,</span></span><br><span class="line"><span class="javascript">                            <span class="function"><span class="keyword">function</span> (<span class="params">errorResponse</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                                <span class="built_in">console</span>.error(<span class="string">"Error while fetching notes"</span>)</span></span><br><span class="line"><span class="undefined">                            &#125;</span></span><br><span class="line"><span class="undefined">                    );</span></span><br><span class="line"><span class="undefined">                &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">                fetchTodos();</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                self.add = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    $http.post(<span class="string">'http://localhost:8000/api/note'</span>, self.newTodo)</span></span><br><span class="line"><span class="undefined">                            .then(fetchTodos)</span></span><br><span class="line"><span class="javascript">                            .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">                                self.newTodo = &#123;&#125;;</span></span><br><span class="line"><span class="undefined">                            &#125;);</span></span><br><span class="line"><span class="undefined">                &#125;;</span></span><br><span class="line"><span class="undefined">            &#125;]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>$http.post，传入了一个额外的参数<code>self.newTodo</code>，postData</li>
</ul>
<h4 id="http-API"><a href="#http-API" class="headerlink" title="$http API"></a>$http API</h4><ul>
<li>GET</li>
<li>HEAD</li>
<li>POST</li>
<li>DELETE</li>
<li>PUT</li>
<li>JSONP</li>
</ul>
<p>$http.get(url, config)可以表示为$http(config)</p>
<h4 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">    method: string,</span><br><span class="line">    url: string,</span><br><span class="line">    params: object,</span><br><span class="line">    data: string or object,</span><br><span class="line">    headers: object,</span><br><span class="line">    xsrfHeaderName: string,</span><br><span class="line">    xsrfCookieName: string,</span><br><span class="line">    transformRequest: function transform(data, headersGetter) or an array of functions,</span><br><span class="line">    transformResponse: function transform(data, headersGetter) or an array of functions,</span><br><span class="line">    cache: boolean or Cache object,</span><br><span class="line">    timeout: number,</span><br><span class="line">    withCredentials: boolean</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Advanced-http"><a href="#Advanced-http" class="headerlink" title="Advanced $http"></a>Advanced $http</h4><p>Configuring $http Defaults</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'notesApp'</span>, [])</span><br><span class="line">    .controller(<span class="string">'LogicCtrl'</span>, [<span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$http</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">        self.user = &#123;&#125;;</span><br><span class="line">        self.message = <span class="string">'Please login'</span>;</span><br><span class="line">        self.login = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            $http.post(<span class="string">'/api/login'</span>, self.user)</span><br><span class="line">                .then(</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">                        self.message = resp.data.msg;</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;])</span><br><span class="line">    .config([<span class="string">'$httpProvider'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$httpProvider</span>) </span>&#123;</span><br><span class="line">        $httpProvider.defaults.transformRequest.push(</span><br><span class="line">            <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> requestStr;</span><br><span class="line">                <span class="keyword">if</span> (data) &#123;</span><br><span class="line">                    data = <span class="built_in">JSON</span>.parse(data);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (requestStr) &#123;</span><br><span class="line">                            requestStr += <span class="string">'&amp;'</span> + key + <span class="string">'='</span> + data[key];</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            requestStr = key + <span class="string">'='</span> + data[key];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> requestStr;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        $httpProvider.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/x-www-form-urlencoded'</span>;</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>application-level configuration</li>
<li>config section for module</li>
<li>injecting $httpProvider</li>
<li>global request transformer<ul>
<li>change all of outbound request post data from JSON into jQuery post string format</li>
<li>then push the transformer into default transformers</li>
<li>这里的transformer类似于django里面的middleware</li>
</ul>
</li>
</ul>
<h5 id="httpProvider-defaults"><a href="#httpProvider-defaults" class="headerlink" title="$httpProvider.defaults"></a>$httpProvider.defaults</h5><pre><code>- headers.common
- headers.get
- headers.put
- headers.post
- transformRequest
- transformResponse
- xsrfHeaderName
- xsrfCookieName
</code></pre><h3 id="Interceptors"><a href="#Interceptors" class="headerlink" title="Interceptors"></a>Interceptors</h3><p>经典的Java编程中的纵切（SOA）概念，主要用来处理：</p>
<ul>
<li>request level actions<ul>
<li>logging</li>
<li>authentication check</li>
<li>handling certain response</li>
</ul>
</li>
</ul>
<p>AngularJS使用$httpProvider去提供interceptor：</p>
<ul>
<li>hook and check each request and response</li>
<li>handle certain events (403 for authentication issue)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'notesApp'</span>, [])</span><br><span class="line">    .controller(<span class="string">'MainCtrl'</span>, [<span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$http</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">        self.items = [];</span><br><span class="line">        self.newTodo = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> fetchTodos = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> $http.get(<span class="string">'http://localhost:8000/api/note'</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">                self.items = response.data;</span><br><span class="line">            &#125;, <span class="function"><span class="keyword">function</span> (<span class="params">errResponse</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'Error while fetching notes'</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        fetchTodos();</span><br><span class="line"></span><br><span class="line">        self.add = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            $http.post(<span class="string">'http://localhost:8000/api/note'</span>, self.newTodo)</span><br><span class="line">                .then(fetchTodos)</span><br><span class="line">                .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">                    self.newTodo = &#123;&#125;;</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;])</span><br><span class="line">    .factory(<span class="string">'MyLoggingInterceptor'</span>, [<span class="string">'$q'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$q</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            request: <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'Request made with '</span>, config);</span><br><span class="line">                <span class="keyword">return</span> config;</span><br><span class="line">            &#125;,</span><br><span class="line">            requestError: <span class="function"><span class="keyword">function</span> (<span class="params">rejection</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'Request error due to '</span>, rejection);</span><br><span class="line">                <span class="keyword">return</span> $q.reject(rejection);</span><br><span class="line">            &#125;,</span><br><span class="line">            response: <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'Response from server'</span>, response);</span><br><span class="line">                <span class="keyword">return</span> response || $q.when(response);</span><br><span class="line">            &#125;,</span><br><span class="line">            responseError: <span class="function"><span class="keyword">function</span> (<span class="params">rejection</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'Error in response '</span>, rejection);</span><br><span class="line">                <span class="keyword">return</span> $q.reject(rejection);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;])</span><br><span class="line">    .config([<span class="string">'$httpProvider'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$httpProvider</span>) </span>&#123;</span><br><span class="line">        $httpProvider.interceptors.push(<span class="string">'MyLoggingInterceptor'</span>);</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>implement the interceptor with factory</li>
<li>request<ul>
<li>any outgoing request passes through the request function</li>
</ul>
</li>
<li>requestError<ul>
<li>triggered if multiple interceptors and one of them rejected the request going out</li>
</ul>
</li>
<li>response<ul>
<li>server eventually returns</li>
</ul>
</li>
<li>responseError<ul>
<li>server return with non-200 series status code</li>
</ul>
</li>
</ul>
<h4 id="Best-Practices-for-http"><a href="#Best-Practices-for-http" class="headerlink" title="Best Practices for $http"></a>Best Practices for $http</h4><ul>
<li>wrap $http in service</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'notesApp'</span>, [])</span><br><span class="line">    .factory(<span class="string">'NoteService'</span>, [<span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$http</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            query: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> $http.get(<span class="string">'/api/notes'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<ul>
<li>use interceptor</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'notesApp'</span>, [])</span><br><span class="line">    .factory(<span class="string">'AuthInterceptor'</span>, [<span class="string">'AuthInterceptor'</span>, <span class="string">'$q'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">AuthInfoService, $q</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            request: <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (AuthInfoService.hasAuthHeader()) &#123;</span><br><span class="line">                    config.headers[<span class="string">'Authorization'</span>] = AuthInfoService.getAuthHeader();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> config;</span><br><span class="line">            &#125;,</span><br><span class="line">            responseError: <span class="function"><span class="keyword">function</span> (<span class="params">responseRejection</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (responseError.status == <span class="number">403</span>) &#123;</span><br><span class="line">                    AuthInfoService.redirectToLogin();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> $q.reject(responseRejection);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;])</span><br><span class="line">    .config([<span class="string">'$httpProvider'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$httpProvider</span>) </span>&#123;</span><br><span class="line">        $httpProvider.interceptors.push(<span class="string">'AuthInterceptor'</span>);</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>chain interceptor</p>
<ul>
<li>创建多个小的interceptor，每个interceptor只有单一的职责</li>
</ul>
</li>
<li><p>leverage default</p>
<ul>
<li>如果endpoint返回的xml，我们可以增加一个缺省的transformResponse到$httpProvider，然后这个transformResponse可以转化xml为json。</li>
</ul>
</li>
</ul>
<p>###Unit Testing Service and XHRs</p>
<p>controller:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'notesApp'</span>, [])</span><br><span class="line">    .controller(<span class="string">'SimpleCtrl'</span>, [<span class="string">'$location'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$location</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">        self.navigate = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            $location.path(<span class="string">'/some/where/else'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<p>conf:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    config.set(&#123;</span><br><span class="line">        basePath: <span class="string">''</span>,</span><br><span class="line">        frameworks: [<span class="string">'jasmine'</span>],</span><br><span class="line">        files: [</span><br><span class="line">            <span class="string">'../bower_components/angular/angular.min.js'</span>,</span><br><span class="line">            <span class="string">'../bower_components/angular-mocks/angular-mocks.js'</span>,</span><br><span class="line">            <span class="string">'*.js'</span></span><br><span class="line">        ],</span><br><span class="line">        exclude: [],</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        logLevel: config.LOG_INFO,</span><br><span class="line">        autoWatch: <span class="literal">true</span>,</span><br><span class="line">        browsers: [<span class="string">'Chrome'</span>],</span><br><span class="line">        singleRun: <span class="literal">false</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>spec:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'SimpleCtrl'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="string">'notesApp'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ctrl, $loc;</span><br><span class="line"></span><br><span class="line">    beforeEach(inject(<span class="function"><span class="keyword">function</span>(<span class="params">$controller, $location</span>) </span>&#123;</span><br><span class="line">        ctrl = $controller(<span class="string">'SimpleCtrl'</span>);</span><br><span class="line">        $loc = $location;</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should navigate away from the current page'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        $loc.path(<span class="string">'/here'</span>);</span><br><span class="line">        ctrl.navigate();</span><br><span class="line">        expect($loc.path()).toEqual(<span class="string">'/some/where/else'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<p>我们这里使用angular-mocks模块去模拟$location service</p>
<h4 id="State-across-Unit-Tests"><a href="#State-across-Unit-Tests" class="headerlink" title="State across Unit Tests"></a>State across Unit Tests</h4><p>simpleCtrl2.js:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'simpleCtrl2App'</span>, [])</span><br><span class="line">    .controller(<span class="string">'SimpleCtrl2'</span>, [<span class="string">'$location'</span>, <span class="string">'$window'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$location, $window</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">        self.navigate1 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            $location.path(<span class="string">'/some/where'</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        self.navigate2 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            $location.path(<span class="string">'/some/where/else'</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<p>simpleCtrl2Spec.js:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'SimpleCtrl2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="string">'simpleCtrl2App'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ctrl, $loc;</span><br><span class="line"></span><br><span class="line">    beforeEach(inject(<span class="function"><span class="keyword">function</span> (<span class="params">$controller, $location</span>) </span>&#123;</span><br><span class="line">        ctrl = $controller(<span class="string">'SimpleCtrl2'</span>);</span><br><span class="line">        $loc = $location;</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should navigate away from the current page'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        expect($loc.path()).toEqual(<span class="string">''</span>);</span><br><span class="line">        $loc.path(<span class="string">'/here'</span>);</span><br><span class="line">        ctrl.navigate1();</span><br><span class="line">        expect($loc.path()).toEqual(<span class="string">'/some/where'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should navigate away from the current page'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        expect($loc.path()).toEqual(<span class="string">''</span>);</span><br><span class="line">        $loc.path(<span class="string">'/there'</span>);</span><br><span class="line">        ctrl.navigate2();</span><br><span class="line">        expect($loc.path()).toEqual(<span class="string">'/some/where/else'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>在一个真实的live的浏览器中，$location是全局可见的，后面的navigation将会看到前面的path</li>
<li>在angularJS的unit testing中，$location在每一个测试方法（test method）中都会被destory，然后重新mock一个新的</li>
</ul>
<h4 id="Mock-Out-Service"><a href="#Mock-Out-Service" class="headerlink" title="Mock Out Service"></a>Mock Out Service</h4><p>noteApp1.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'notesApp1'</span>, [])</span><br><span class="line">    .factory(<span class="string">'ItemService'</span>, [<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> items = [</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Item 0'</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">label</span>: <span class="string">'Item1'</span>&#125;</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            list: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> items;</span><br><span class="line">            &#125;,</span><br><span class="line">            add: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                items.push(item);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;])</span><br><span class="line">    .controller(<span class="string">'ItemCtrl'</span>, [<span class="string">'ItemService'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ItemService</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">        self.items = ItemService.list();</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<p>notesApp1Spec.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'ItemCtrl with inline mock'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="string">'notesApp1'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ctrl, mockService;</span><br><span class="line"></span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="function"><span class="keyword">function</span>(<span class="params">$provide</span>) </span>&#123;</span><br><span class="line">        mockService = &#123;</span><br><span class="line">            list: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> [&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Mock'</span>&#125;];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        $provide.value(<span class="string">'ItemService'</span>, mockService);</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    beforeEach(inject(<span class="function"><span class="keyword">function</span>(<span class="params">$controller</span>) </span>&#123;</span><br><span class="line">        ctrl = $controller(<span class="string">'ItemCtrl'</span>);</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should load mocked out items'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        expect(ctrl.items).toEqual([&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Mock'</span>&#125;]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>with our own mock to override ItemService</li>
<li>use module function to mock service</li>
<li>we pass a function to <code>module function</code></li>
<li>the passed function is injected with $provide</li>
<li>use provider to overrid the original service with mocked service</li>
</ul>
<p>如果我们需要reuse mocked service，我们可以在global level的mock：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'notesApp1Mocks'</span>, [])</span><br><span class="line">.factory(<span class="string">'ItemService'</span>, [<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        list: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> [&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Mock'</span>&#125;];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'ItemCtrl with global mock'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ctrl;</span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="string">'notesApp1'</span>));</span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="string">'notesApp1Mocks'</span>));</span><br><span class="line"></span><br><span class="line">    beforeEach(inject(<span class="function"><span class="keyword">function</span>(<span class="params">$controller</span>) </span>&#123;</span><br><span class="line">        ctrl = $controller(<span class="string">'ItemCtrl'</span>);</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should load mocked out items'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        expect(ctrl.items).toEqual([&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Mock'</span>&#125;]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Jasmine-Spies"><a href="#Jasmine-Spies" class="headerlink" title="Jasmine Spies"></a>Jasmine Spies</h3><p>这个库类似于Python中的inspect，用来窥视函数在运行时内部的状态统计：</p>
<ul>
<li>是否被call</li>
<li>被call多少次</li>
<li>用到了什么参数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'ItemCtrl with spies'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="string">'notesApp1'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ctrl, itemService;</span><br><span class="line"></span><br><span class="line">    beforeEach(inject(<span class="function"><span class="keyword">function</span>(<span class="params">$controller, ItemService</span>) </span>&#123;</span><br><span class="line">        spyOn(ItemService, <span class="string">'list'</span>).and.callThrough();</span><br><span class="line">        itemService = ItemService;</span><br><span class="line">        ctrl = $controller(<span class="string">'ItemCtrl'</span>);</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should load mocked out items'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        expect(itemService.list).toHaveBeenCalled();</span><br><span class="line">        expect(itemService.list.calls.count()).toEqual(<span class="number">1</span>);</span><br><span class="line">        expect(ctrl.items).toEqual([</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Item 0'</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">label</span>: <span class="string">'Item 1'</span>&#125;</span><br><span class="line">        ]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>解析： 这个jasmine spies其实就是angular的instrumentation，然后在assert中调用instrumentation中采集到的特性。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'ItemCtrl with SpyReturn'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="string">'notesApp1'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ctrl, itemService;</span><br><span class="line"></span><br><span class="line">    beforeEach(inject(<span class="function"><span class="keyword">function</span> (<span class="params">$controller, ItemService</span>) </span>&#123;</span><br><span class="line">        spyOn(ItemService, <span class="string">'list'</span>)</span><br><span class="line">            .and.returnValue([&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Mock'</span>&#125;]);</span><br><span class="line"></span><br><span class="line">        itemService = ItemService;</span><br><span class="line">        ctrl = $controller(<span class="string">'ItemCtrl'</span>);</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should load mocked out items'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        expect(itemService.list).toHaveBeenCalled();</span><br><span class="line">        expect(itemService.list.calls.count()).toEqual(<span class="number">1</span>);</span><br><span class="line">        expect(ctrl.items).toEqual([&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Mock'</span>&#125;]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>这里通过Jasmine Spies提供了mock库里最常见的功能，就是模拟返回值</li>
</ul>
<h4 id="Unit-Testing-Server-Call"><a href="#Unit-Testing-Server-Call" class="headerlink" title="Unit Testing Server Call"></a>Unit Testing Server Call</h4><p>angular的mock库中，所有$http服务都是local，context都是unit test自己的环境，而不会发生任何server call，所有的server call都会被intercepted。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'serverApp'</span>, [])</span><br><span class="line">.controller(<span class="string">'MainCtrl'</span>, [<span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$http</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    self.items = [];</span><br><span class="line">    self.errorMessage = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">    $http.get(<span class="string">'/api/note'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        self.items = response.data;</span><br><span class="line">    &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">errResponse</span>) </span>&#123;</span><br><span class="line">        self.errorMessage = errResponse.data.msg;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'MainCtrl Server Call'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="string">'serverApp'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ctrl, mockBackend;</span><br><span class="line"></span><br><span class="line">    beforeEach(inject(<span class="function"><span class="keyword">function</span> (<span class="params">$controller, $httpBackend</span>) </span>&#123;</span><br><span class="line">        mockBackend = $httpBackend;</span><br><span class="line">        mockBackend.when(<span class="string">'GET'</span>, <span class="string">'/api/note'</span>).respond([&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Mock'</span>&#125;]);</span><br><span class="line"></span><br><span class="line">        ctrl = $controller(<span class="string">'MainCtrl'</span>);</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should load items from server'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        expect(ctrl.items).toEqual([]);</span><br><span class="line">        mockBackend.flush();</span><br><span class="line">        expect(ctrl.items).toEqual([&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">label</span>: <span class="string">'Mock'</span>&#125;]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    afterEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        mockBackend.verifyNoOutstandingExpectation();</span><br><span class="line">        mockBackend.verifyNoOutstandingRequest();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li><p>使用了angular-mocks.js中的$httpBackend</p>
<ul>
<li>expect<ul>
<li>it is used when we want to control exactly how many requests, what URLs and then control the response</li>
<li>fine-grained</li>
</ul>
</li>
<li>when<ul>
<li>when does not care about the order of request, or how many times</li>
<li>coarse-grained</li>
</ul>
</li>
</ul>
</li>
<li><p>verifyNoOutstandingExpectations()，检查是否在$httpBackend中设定了某些expect，并没有被test所满足</p>
</li>
<li>verifyNoOutstandingRequest()，检查所有的server call都被flush了</li>
</ul>
<h3 id="Integration-Level-Unit-Tests"><a href="#Integration-Level-Unit-Tests" class="headerlink" title="Integration Level Unit Tests"></a>Integration Level Unit Tests</h3><p>基于良好的习惯，我们没有把$http call放在controller中，而是放在服务中（NoteService），我们的controller然后delegate到服务中去获取服务器内容，我们有两个选项：</p>
<ul>
<li>mock out NoteService，然后保证我们的controller对service的调用被delegate到mock到NoteService中去</li>
<li>integration level unit testing，这里主要是使用$httpBackend去mock out整个后端</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'Server App Integration'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="string">'serverApp2'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ctrl, mockBackend;</span><br><span class="line"></span><br><span class="line">    beforeEach(inject(<span class="function"><span class="keyword">function</span>(<span class="params">$controller, $httpBackend</span>) </span>&#123;</span><br><span class="line">        mockBackend = $httpBackend;</span><br><span class="line">        mockBackend.expect(<span class="string">'GET'</span>, <span class="string">'/api/note'</span>)</span><br><span class="line">            .respond(<span class="number">404</span>, &#123;<span class="attr">msg</span>: <span class="string">'Not Found'</span>&#125;);</span><br><span class="line">        ctrl = $controller(<span class="string">'MainCtrl'</span>);</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should handle error while loading items'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        expect(ctrl.items).toEqual([]);</span><br><span class="line">        mockBackend.flush();</span><br><span class="line">        expect(ctrl.items).toEqual([]);</span><br><span class="line">        expect(ctrl.errorMessage).toEqual(<span class="string">'Not Found'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    afterEach(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        mockBackend.verifyNoOutstandingExpectation();</span><br><span class="line">        mockBackend.verifyNoOutstandingRequest();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<p>easy case。就是模拟了一个服务的返回值。</p>
<hr>
<h3 id="Working-with-Filters"><a href="#Working-with-Filters" class="headerlink" title="Working with Filters"></a>Working with Filters</h3><p>AngularJS 的 filter 是用来处理数据，然后格式化数据后呈现给用户。Filter可以被用在HTML的标签上，或者直接用在controller或者service上。大多数情况，filter是最后的一层，在把数据最终展示在用户面前。</p>
<p>Filter经常出现的情景：</p>
<ul>
<li>格式化显示一个timestamp</li>
<li>增加货币符号在结算货币的数字前面</li>
<li>在view层提供动态生成的数据，对这些数据的修改不会原始值</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Filter in Action<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"filterApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"FilterCtrl as ctrl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Amount as a number: &#123;&#123; ctrl.amount | number&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Total cost as a currency: &#123;&#123;ctrl.totalCost | currency&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Total cost in INR: &#123;&#123;ctrl.totalCost | currency:'INR'&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Shouting the name: &#123;&#123;ctrl.name | uppercase&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Whispering the name: &#123;&#123;ctrl.name | lowercase&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Start Time: &#123;&#123;ctrl.startTime | date:'medium'&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'filterApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'FilterCtrl'</span>, [<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.amount = <span class="number">1024</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.totalCost = <span class="number">4906</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.name = <span class="string">'Shyam Seshadri'</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="undefined">            &#125;]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：这里的filter主要用在HTML的element中，很简单，跟django的template里的filter用法差不多，<code>{{expression | filter}}</code></p>
<p>Filter用法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;expression | filter&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;expression | filter1 | filter2&#125;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">filterLiteral:argument</span><br></pre></td></tr></table></figure>
<p>Common Filters:</p>
<ul>
<li>currency</li>
<li>number</li>
<li>lowercase</li>
<li>uppercase</li>
<li>json</li>
<li>date</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Filter in Action<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"filterApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"FilterCtrl as ctrl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Amount - &#123;&#123;ctrl.amount&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Amount - default currency: &#123;&#123;ctrl.amount | currency&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Amount - INR currency &#123;&#123;ctrl.amount | currency:'INR'&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Amount - number &#123;&#123;ctrl.amount | number&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Amount - number with 4 decimals: &#123;&#123;ctrl.amount | number:4&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Name without filters: &#123;&#123;ctrl.name&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Name - lowercase filter: &#123;&#123;ctrl.name | lowercase&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Name - uppercase filter: &#123;&#123;ctrl.name | uppercase&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>The JSON Filter: &#123;&#123;ctrl.obj | json&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Timestamp: &#123;&#123;ctrl.startTime | date&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Timestamp: &#123;&#123;ctrl.startTime | date:'medium'&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Timestamp: &#123;&#123;ctrl.startTime | date: 'M/dd, yyyy'&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'filterApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'FilterCtrl'</span>, [<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.amount = <span class="number">1024</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.totalCost = <span class="number">4906</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.obj = &#123;<span class="attr">test</span>: <span class="string">'value'</span>, <span class="attr">number</span>: <span class="number">123</span>&#125;;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="undefined">            &#125;]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>limitTo</p>
<ul>
<li>return subarray or substring</li>
</ul>
</li>
<li><p>orderBy</p>
<ul>
<li>take an array ordered by a predicate expression</li>
<li>second optional argument determine whether the result should be reversed</li>
<li><code>+</code>, <code>-</code> sign before the field name(key) to sort ascending or descending</li>
<li>pass a function as argument, the value return by function will be used for comparation</li>
</ul>
</li>
<li><p>filter</p>
<ul>
<li>filter an array by predicate or functions</li>
<li>used along with the ng-repeat</li>
<li>can be applied to:<ul>
<li>string</li>
<li>object</li>
<li>function</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Filters in Action<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"filterApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"FilterCtrl as ctrl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.currentFilter = 'string'"</span>&gt;</span>Filter with String<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.currentFilter = 'object'"</span>&gt;</span>Filter with Object<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.currentFilter = 'function'"</span>&gt;</span>Filter with Function<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    Filter Text</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.filterOptions['string']"</span> <span class="attr">placeholder</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line">    Show Done Only</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">ng-model</span>=<span class="string">"ctrl.filterOptions['object'].done"</span> <span class="attr">placeholder</span>=<span class="string">""</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">ng-repeat</span>=<span class="string">"note in ctrl.notes | filter:ctrl.filterOptions[ctrl.currentFilter] | orderBy:ctrl.sortOrder | limitTo:5"</span>&gt;</span></span><br><span class="line">            &#123;&#123;note.label&#125;&#125; - &#123;&#123;note.type&#125;&#125; - &#123;&#123;note.done&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">"filterApp"</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'FilterCtrl'</span>, [<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.notes = [</span></span><br><span class="line"><span class="javascript">                    &#123;<span class="attr">label</span>: <span class="string">'FC todo'</span>, <span class="attr">type</span>: <span class="string">'chore'</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;,</span></span><br><span class="line"><span class="javascript">                    &#123;<span class="attr">label</span>: <span class="string">'FT todo'</span>, <span class="attr">type</span>: <span class="string">'task'</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="javascript">                    &#123;<span class="attr">label</span>: <span class="string">'FF todo'</span>, <span class="attr">type</span>: <span class="string">'fun'</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="javascript">                    &#123;<span class="attr">label</span>: <span class="string">'SC todo'</span>, <span class="attr">type</span>: <span class="string">'chore'</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;,</span></span><br><span class="line"><span class="javascript">                    &#123;<span class="attr">label</span>: <span class="string">'ST todo'</span>, <span class="attr">type</span>: <span class="string">'task'</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="javascript">                    &#123;<span class="attr">label</span>: <span class="string">'SF todo'</span>, <span class="attr">type</span>: <span class="string">'fun'</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="javascript">                    &#123;<span class="attr">label</span>: <span class="string">'TC todo'</span>, <span class="attr">type</span>: <span class="string">'chore'</span>, <span class="attr">done</span>: <span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="javascript">                    &#123;<span class="attr">label</span>: <span class="string">'TT todo'</span>, <span class="attr">type</span>: <span class="string">'task'</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;,</span></span><br><span class="line"><span class="javascript">                    &#123;<span class="attr">label</span>: <span class="string">'TF todo'</span>, <span class="attr">type</span>: <span class="string">'fun'</span>, <span class="attr">done</span>: <span class="literal">false</span>&#125;</span></span><br><span class="line"><span class="undefined">                ];</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.sortOrder = [<span class="string">'+type'</span>, <span class="string">'-label'</span>];</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.filterOptions = &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="string">"string"</span>: <span class="string">''</span>,</span></span><br><span class="line"><span class="javascript">                    <span class="string">"object"</span>: &#123;<span class="attr">done</span>: <span class="literal">false</span>, <span class="attr">label</span>: <span class="string">'C'</span>&#125;,</span></span><br><span class="line"><span class="javascript">                    <span class="string">"function"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">note</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> note.type === <span class="string">'task'</span> &amp;&amp; note.done === <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.currentFilter = <span class="string">'string'</span>;</span></span><br><span class="line"><span class="undefined">            &#125;]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>string: 基于object的key</li>
<li>object: more fine-grained criteria</li>
<li>function: based on return value: true | false</li>
</ul>
<h4 id="Use-Filter-in-Controller-and-Services"><a href="#Use-Filter-in-Controller-and-Services" class="headerlink" title="Use Filter in Controller and Services"></a>Use Filter in Controller and Services</h4><ul>
<li>任何filter（内生或者自建），都可以注入service或者controller</li>
<li>需要增加一个affix</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">angular.module(&apos;myModule&apos;, [])</span><br><span class="line">    .controller(&apos;MyCtrl&apos;, [&apos;currencyFilter&apos;,</span><br><span class="line">        function(currencyFilter) &#123;</span><br><span class="line">            // do stuff</span><br><span class="line">        &#125;</span><br><span class="line">    ]);</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">self.filterArray = filterFilter(self.notes, &apos;ch&apos;);</span><br></pre></td></tr></table></figure>
<ul>
<li>filterFilter表明要使用的filter是filter函数, 其中<code>Filter</code>是后缀<code>suffix</code></li>
<li>1st argument is the data act upon</li>
<li>further argument are filter needs</li>
<li>return value is the filter result that we need</li>
</ul>
<h4 id="Create-own-filter"><a href="#Create-own-filter" class="headerlink" title="Create own filter"></a>Create own filter</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Custom Filters in Action<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"filterApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"FilterCtrl as ctrl"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Start Time (TimeStamp): &#123;&#123;ctrl.startTime&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Start Time (DateTime): &#123;&#123;ctrl.startTime | date: 'medium'&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>Start Time (Our Filter): &#123;&#123;ctrl.startTime | timeAgo&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>someTimeAgo: &#123;&#123;ctrl.someTimeAgo | date:'short'&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>someTimeAgo (Our Filter): &#123;&#123;ctrl.someTimeAgo | timeAgo&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'filterApp'</span>, [])</span></span><br><span class="line"><span class="javascript">            .controller(<span class="string">'FilterCtrl'</span>, [<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.startTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">this</span>.someTimeAgo = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - (<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">4</span>);</span></span><br><span class="line"><span class="undefined">            &#125;])</span></span><br><span class="line"><span class="javascript">            .filter(<span class="string">'timeAgo'</span>, [<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> ONE_MINUTE = <span class="number">1000</span> * <span class="number">60</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> ONE_HOUR = ONE_MINUTE * <span class="number">60</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> ONE_DAY = ONE_HOUR * <span class="number">24</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> ONE_MONTH = ONE_DAY * <span class="number">30</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">ts</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> currentTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> diff = currentTime - ts;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (diff &lt; ONE_MINUTE) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> <span class="string">'seconds ago'</span>;</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_HOUR) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> <span class="string">'minutes ago'</span></span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_DAY) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> <span class="string">'hours ago'</span>;</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_MONTH) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> <span class="string">'days ago'</span>;</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span> <span class="string">'months ago'</span>;</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;;</span></span><br><span class="line"><span class="undefined">            &#125;]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>我们创建的filter返回了一个function，这个function将会在每一次filter被应用时调用</li>
<li>返回的函数的参数默认是从pipe来的上游的数据，如果我们需要额外的参数可以更改为:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">return function(ts, otherArgument) &#123; ... &#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>然后在使用filter时，我们可以<code>filter:argument</code></li>
</ul>
<h3 id="Things-to-Remember-about-Filters"><a href="#Things-to-Remember-about-Filters" class="headerlink" title="Things to Remember about Filters"></a>Things to Remember about Filters</h3><ul>
<li>View中的filter被执行的非常频繁，需要考虑filter带来的额外的性能问题</li>
<li>Filter应该被设计的比较快速</li>
<li>优先在service或者controller中使用filter         </li>
</ul>
<hr>
<h3 id="Unit-Testing-Filters"><a href="#Unit-Testing-Filters" class="headerlink" title="Unit Testing Filters"></a>Unit Testing Filters</h3><p>示例程序：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'filterApp'</span>, [])</span><br><span class="line">    .filter(<span class="string">'timeAgo'</span>, [<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> ONE_MINUTE = <span class="number">1000</span> * <span class="number">60</span>;</span><br><span class="line">        <span class="keyword">var</span> ONE_HOUR = ONE_MINUTE * <span class="number">60</span>;</span><br><span class="line">        <span class="keyword">var</span> ONE_DAY = ONE_HOUR * <span class="number">24</span>;</span><br><span class="line">        <span class="keyword">var</span> ONE_MONTH = ONE_DAY * <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">ts, optShowSecondMessage</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (optShowSecondMessage !== <span class="literal">false</span>) &#123;</span><br><span class="line">                optShowSecondMessage = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> currentTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">            <span class="keyword">var</span> diff = currentTime - ts;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (diff &lt; ONE_MINUTE &amp;&amp; optShowSecondMessage) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'seconds ago'</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_HOUR) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'minutes ago'</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_DAY) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'hours ago'</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; ONE_MONTH) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'days ago'</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'months ago'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<p>Spec测试文件：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">describe(<span class="string">'timeAgo Filter'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    beforeEach(<span class="built_in">module</span>(<span class="string">'filterApp'</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> filter;</span><br><span class="line"></span><br><span class="line">    beforeEach(inject(<span class="function"><span class="keyword">function</span>(<span class="params">timeAgoFilter</span>) </span>&#123;</span><br><span class="line">        filter = timeAgoFilter;</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    it(<span class="string">'should respond based on timestamp'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> currentTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">        currentTime -= <span class="number">10000</span>;</span><br><span class="line">        expect(filter(currentTime, <span class="literal">false</span>)).toEqual(<span class="string">'minutes ago'</span>);</span><br><span class="line">        <span class="keyword">var</span> fewMinutesAgo = currentTime - <span class="number">1000</span> * <span class="number">60</span>;</span><br><span class="line">        expect(filter(fewMinutesAgo, <span class="literal">false</span>)).toEqual(<span class="string">'minutes ago'</span>);</span><br><span class="line">        <span class="keyword">var</span> fewHoursAgo = currentTime - <span class="number">1000</span> * <span class="number">60</span> * <span class="number">68</span>;</span><br><span class="line">        expect(filter(fewHoursAgo, <span class="literal">false</span>)).toEqual(<span class="string">'hours ago'</span>);</span><br><span class="line">        <span class="keyword">var</span> fewDaysAgo = currentTime - <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">26</span>;</span><br><span class="line">        expect(filter(fewDaysAgo, <span class="literal">false</span>)).toEqual(<span class="string">'days ago'</span>);</span><br><span class="line">        <span class="keyword">var</span> fewMonthsAgo = currentTime - <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">32</span>;</span><br><span class="line">        expect(filter(fewMonthsAgo, <span class="literal">false</span>)).toEqual(<span class="string">'months ago'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>解析：很简单，没啥好说的。</p>
<hr>
<h3 id="Routing-Using-ngRoute"><a href="#Routing-Using-ngRoute" class="headerlink" title="Routing Using ngRoute"></a>Routing Using ngRoute</h3><ul>
<li>ngRoute是angular的可选模块</li>
<li>do routing task in angular application</li>
<li>routing in angular is declarative</li>
</ul>
<p>routing 在angular中不是标准的URLs，而不是被称作为hashbang（#!）的URLs，比如下面：</p>
<ul>
<li><a href="http://my.app.com/#/first/page" target="_blank" rel="noopener">http://my.app.com/#/first/page</a></li>
<li><a href="http://my.app.com/#!/first/page" target="_blank" rel="noopener">http://my.app.com/#!/first/page</a></li>
</ul>
<p>这里之所以用hashbang，是因为浏览器对hashbang的特殊的处理：</p>
<ul>
<li>在angular中我们不想遇到full page载入</li>
<li>我们只想载入relevant的部分</li>
<li>浏览器不会把#或者#!后面的内容加入到请求的URL中去<ul>
<li>比如，<code>http://www.app.com/#/first/page</code>，浏览器的header只有<code>http://www.app.com/</code></li>
</ul>
</li>
<li>angular利用hashbang去做页面的navigation</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>AngularJS Routing<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular/angular.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../bower_components/angular-route/angular-route.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"routingApp"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Angular Routing Application<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/"</span>&gt;</span>Default Route<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/second"</span>&gt;</span>Second Route<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#/asdf"</span>&gt;</span>Nonexisting Route<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-view</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    angular.module(<span class="string">'routingApp'</span>, [<span class="string">'ngRoute'</span>])</span></span><br><span class="line"><span class="javascript">            .config([<span class="string">'$routeProvider'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$routeProvider</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                $routeProvider.when(<span class="string">'/'</span>, &#123;</span></span><br><span class="line"><span class="xml">                            template: '<span class="tag">&lt;<span class="name">h5</span>&gt;</span>This is the default route<span class="tag">&lt;/<span class="name">h5</span>&gt;</span>'</span></span><br><span class="line"><span class="undefined">                        &#125;)</span></span><br><span class="line"><span class="javascript">                        .when(<span class="string">'/second'</span>, &#123;</span></span><br><span class="line"><span class="xml">                            template: '<span class="tag">&lt;<span class="name">h5</span>&gt;</span>This is the second route<span class="tag">&lt;/<span class="name">h5</span>&gt;</span>'</span></span><br><span class="line"><span class="undefined">                        &#125;)</span></span><br><span class="line"><span class="javascript">                        .otherwise(&#123;<span class="attr">redirectTo</span>: <span class="string">'/'</span>&#125;);</span></span><br><span class="line"><span class="undefined">            &#125;]);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>Include angular-route.js载入ngRoute</li>
<li>ng-view directive where routing is to take effect</li>
<li>多加了一个依赖<code>angular.module(&#39;routingApp&#39;, [&#39;ngRoute&#39;])</code></li>
<li>使用<code>$routeProvider</code>这个angular内生的服务去定义route</li>
<li>页面内的navigation是通过a tag去实现的，当然也可以通过操作browser URL</li>
<li>由于angular利用了浏览器的history去做navigation，因此是可以前进后退的</li>
<li>$routeProvider定义routes用<code>when()</code>函数，有两个参数：<ul>
<li>第一个是URL或者URL regex</li>
<li>第二个是routing对应的行为</li>
</ul>
</li>
<li><code>otherwise()</code>定义了默认的行为</li>
</ul>
<h5 id="Routing-Options"><a href="#Routing-Options" class="headerlink" title="Routing Options"></a>Routing Options</h5><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$routeProvider.when(url, &#123;</span><br><span class="line">    template: string,</span><br><span class="line">    tempateUrl: string,</span><br><span class="line">    controller: string, <span class="function"><span class="keyword">function</span> <span class="title">or</span> <span class="title">array</span>,</span></span><br><span class="line"><span class="function">    <span class="title">controllerAs</span>: <span class="title">string</span>,</span></span><br><span class="line"><span class="function">    <span class="title">resolve</span>: <span class="title">object</span>&lt;<span class="title">key</span>, <span class="title">function</span>&gt;</span></span><br><span class="line"><span class="function">&#125;);</span></span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li>url, URL mapping to views</li>
<li>template: 与ng-view配合，直接替换ng-view所在元素的子元素</li>
<li>templateUrl:</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$routeProvider.when(<span class="string">'/test'</span>, &#123;</span><br><span class="line">    templateUrl: <span class="string">'views/test.html'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="string">``</span><span class="string">`        </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- controller，routing所使用到的controller，可以有两种方式定义：</span></span><br><span class="line"><span class="string">    - 直接用字符串引用定义在html中的controller，通过ng-controller directive</span></span><br><span class="line"><span class="string">    - inline实现</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>javascript</span><br><span class="line">$routeProvider.when(<span class="string">'/test'</span>, &#123;</span><br><span class="line">    template: <span class="string">'&lt;h1&gt;Test Route&lt;/h1&gt;'</span>,</span><br><span class="line">    controller: [<span class="string">'$window'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$windwow</span>) </span>&#123;</span><br><span class="line">        $<span class="built_in">window</span>.alert(<span class="string">'Test route has been loaded'</span>);</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>controllerAs，很简单</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$routeProvider.when(<span class="string">'/test'</span>, &#123;</span><br><span class="line">    template: <span class="string">'&lt;h1&gt;Test Route&lt;/h1&gt;'</span>,</span><br><span class="line">    controller: <span class="string">'MyCtrl as ctrl'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$routeProvider.when(<span class="string">'/test'</span>, &#123;</span><br><span class="line">    template: <span class="string">'&lt;h1&gt;Test Route&lt;/h1&gt;'</span>,</span><br><span class="line">    controller: <span class="string">'MyCtrl'</span>,</span><br><span class="line">    controllerAs: <span class="string">'ctrl'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>redirectTo</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$routeProvider.when(<span class="string">'/new'</span>, &#123;</span><br><span class="line">    template: <span class="string">'&lt;h1&gt;Test Route&lt;/h1&gt;'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$routeProvider.when(<span class="string">'/old'</span>, &#123;</span><br><span class="line">    redirectTo: <span class="string">'/new'</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>resolve:<ul>
<li>executing or finishing some asynchronouse tasks before route works<ul>
<li>authentication, permission</li>
</ul>
</li>
<li>preload some data before controller and route</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">angular.module(&apos;resolveApp, [&apos;ngRoute&apos;])</span><br><span class="line">    .value(&apos;Constant&apos;, &#123;MAGIC_NUMBER: 42&#125;)</span><br><span class="line">    .config([&apos;$routeProvider&apos;, function($routeProvider) &#123;</span><br><span class="line">        $routeProvider.when(&apos;/&apos;, &#123;</span><br><span class="line">            template: &apos;&lt;h1&gt;Main Page, no resolves&lt;/h1&gt;&apos;</span><br><span class="line">        &#125;).when(&apos;/protected&apos;, &#123;</span><br><span class="line">            template: &apos;&lt;h2&gt;Protected Page&lt;/h2&gt;&apos;,</span><br><span class="line">            resolve: &#123;</span><br><span class="line">                immediate: [&apos;Constant&apos;, function(Constant) &#123;</span><br><span class="line">                    return Constant.MAGIC_NUMBER * 4;</span><br><span class="line">                &#125;],</span><br><span class="line">                async: [&apos;$http&apos;, function($http) &#123;</span><br><span class="line">                    return $http.get(&apos;/api/hasAccess&apos;);</span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            controller: [&apos;$log&apos;, immediate, async, function($log, immediate, async) &#123;</span><br><span class="line">                $log.log(&apos;Immediate is &apos;, immediate);</span><br><span class="line">                $log.log(&apos;Server returned for async&apos;, async);</span><br><span class="line">            &#125;]</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<p>resolve定义了2个key：</p>
<pre><code>- immediate: 每个key都返回一个array，array里面遵循Angular DI语法
    - 依赖Constant，然后利用注入的Constant，返回一个常量*number
- async: 注入了$http依赖，然后调用server的get方法，返回一个promise
</code></pre><ul>
<li><p>angular对resolve的保证：</p>
<ul>
<li>如果resolve返回一个常量，angular立即结束resolve执行，并返回一个成功的resolve</li>
<li>如果resolve返回一个promise，则angular则一直阻塞到promise返回，如果返回的是successful，则resolve被当作success，否则fail</li>
<li>如果有resolve存在，则angular保证所有的routing不会执行，直到resolve返回</li>
<li>如果resolve返回错误或者异常，则angular不会执行route</li>
</ul>
</li>
<li><p>resolve中的key可以被注入angular的controller:</p>
<ul>
<li>如果是值，则直接解析为值</li>
<li>如果是promise，则返回promise的解析值</li>
</ul>
</li>
</ul>
<h3 id="routeParams-服务"><a href="#routeParams-服务" class="headerlink" title="$routeParams 服务"></a>$routeParams 服务</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">angular.module(<span class="string">'resolveApp'</span>, [<span class="string">'ngRoute'</span>])</span><br><span class="line">    .config([<span class="string">'$routeProvider'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$routeProvider</span>) </span>&#123;</span><br><span class="line">        $routeProvider.when(<span class="string">'/'</span>, &#123;</span><br><span class="line">            template: <span class="string">'&lt;h1&gt;Main Page&lt;/h1&gt;'</span></span><br><span class="line">        &#125;).when(<span class="string">'/detail/:detId'</span>, &#123;</span><br><span class="line">            template: <span class="string">'&lt;h2&gt;Loaded &#123;&#123;myCtrl.detailId&#125;&#125;'</span> +</span><br><span class="line">                <span class="string">' and query string is &#123;&#123;myCtrl.qStr&#125;&#125;&lt;/h2&gt;'</span>,</span><br><span class="line">            controller: [<span class="string">'$routeParams'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$routeParams</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.detaildId = $routeParams.detId;</span><br><span class="line">                <span class="keyword">this</span>.qStr = $routeParams.q;</span><br><span class="line">            &#125;],</span><br><span class="line">            controllerAs: <span class="string">'myCtrl'</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;]);</span><br></pre></td></tr></table></figure>
<p>解析：</p>
<ul>
<li><p><code>/detail/:detId</code> 表明在<code>/detail</code>的后面将会有一个value，并会被存储为detId</p>
<ul>
<li>这个其实就是regex中的named group</li>
</ul>
</li>
<li><p>这些被存储到的name group的值，会被放在$routeParams中</p>
</li>
</ul>
<p><code>/detail/123?q=MySearchParam</code>将会被存储为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    detId: &apos;123&apos;,</span><br><span class="line">    q: &apos;MySearchParam&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="One-more-thing"><a href="#One-more-thing" class="headerlink" title="One more thing"></a>One more thing</h3><ul>
<li>Empty template</li>
</ul>
<p>angularJS需要每一个route都有一个nonempty的template或者templateUrl，如果没有这些，angular将会静默地丢掉route</p>
<ul>
<li>Resolve injection into controller</li>
</ul>
<p>如果需要resolve的值注入controller，那么就需要把controller定义在route中，而不是使用ng-controller directive，因为没有上下文，angular不知道哪个controller需要注入</p>
<ul>
<li>$routeParam vaiable type</li>
</ul>
<p>$routeParam的key返回的值默认都是string，所以<code>===</code>比较会出问题，需要转化为合适类型</p>
<ul>
<li>One ng-view per application</li>
</ul>
<p>ng-view不能多个，不能嵌套，用来展示route返回的内容    </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/11/27/Reading-Note-OReilly-Introduction-To-AngularJS/" data-id="cjrjycryt00y7batin1bhdt5p" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AngularJS/">AngularJS</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/11/30/Hacker-Need-Scripts/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          黑客入门必须脚本
        
      </div>
    </a>
  
  
    <a href="/2015/11/24/Cross-Origin-CSS-Attack/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">CSS跨站攻击原理与防护</div>
    </a>
  
</nav>

  
</article>

</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Innards/">内核</a><span class="category-list-count">48</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Functional-Programming/">函数编程</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Dynamic-Programming/">动态编程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Fun/">好玩</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">安卓</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Recommend/">推荐</a><span class="category-list-count">57</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">数学</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">数据库</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solutions/">方案</a><span class="category-list-count">64</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MachineLearning/">机器学习</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Testing/">测试</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Coding/">程序语言</a><span class="category-list-count">71</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Notes/">笔记</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algo/">算法</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Automation/">自动化</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ComputerVision/">计算机视觉</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Review/">评测</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Interview/">面试</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">49</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">32</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">30</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">24</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Meng Jue (M)<br>
    </div>
  </div>
</footer>

    



<script src="/js/jquery-2.2.0.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>