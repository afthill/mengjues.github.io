<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Archives | Make Fun</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Make fun with the world">
<meta property="og:type" content="website">
<meta property="og:title" content="Make Fun">
<meta property="og:url" content="http://m.imf.cc/archives/page/30/index.html">
<meta property="og:site_name" content="Make Fun">
<meta property="og:description" content="Make fun with the world">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Make Fun">
<meta name="twitter:description" content="Make fun with the world">
  
  
  <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/open-fonts/css/open-sans.css">
  <link rel="stylesheet" href="/open-fonts/css/share-tech-mono.css">
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  

</head>
</html>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo"></i><span class="site-title">Make Fun</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div class="profile" id="profile-nav">
          <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/css/images/avatar.png"><i class="fa fa-caret-down"></i></a>
        </div>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://m.imf.cc"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
      
        <td><a class="main-nav-link" href="/">Home</a></td>
      
        <td><a class="main-nav-link" href="/archives">Archives</a></td>
      
        <td><a class="main-nav-link" href="/about">About</a></td>
      
      <td>
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://m.imf.cc"></form>
      </td>
      </tr>
    </table>
  </div>
  
  <div id="header-sub" class="header-sub header-inner">
    <div class="outer">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Innards/">内核</a><span class="category-list-count">48</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Functional-Programming/">函数编程</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Dynamic-Programming/">动态编程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Fun/">好玩</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">安卓</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Recommend/">推荐</a><span class="category-list-count">57</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">数学</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">数据库</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solutions/">方案</a><span class="category-list-count">64</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MachineLearning/">机器学习</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Testing/">测试</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Coding/">程序语言</a><span class="category-list-count">71</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Notes/">笔记</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algo/">算法</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Automation/">自动化</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ComputerVision/">计算机视觉</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Review/">评测</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Interview/">面试</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>
  
</header>
    <div class="outer">
      <aside id="profile">
  <div class="inner profile-inner">
  	<div class="base-info profile-block">
		  <img id="avatar" src="/css/images/avatar.png">
      <h2 id="name">Meng Jue (M)</h2>
      <h3 id="title">Strict Developer &amp; Funny Player</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Shanghai, China</span>
      <a id="follow" href="https://github.com/MengjueM">关注我</a>
  	</div>
    <div class="article-info profile-block">
      <div class="article-info-block">
        319
        <span>文章</span>
      </div>
      <div class="article-info-block">
        236
        <span>标签</span>
      </div>
    </div>
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
        
          <td><a href="http://github.com/MengjueM" title="github"><i class="fa fa-github"></i></a></td>
        
          <td><a href="#" title="twitter"><i class="fa fa-twitter"></i></a></td>
        
          <td><a href="#" title="facebook"><i class="fa fa-facebook"></i></a></td>
        
          <td><a href="#" title="dribbble"><i class="fa fa-dribbble"></i></a></td>
        
          <td><a href="/atom.xml" title="rss"><i class="fa fa-rss"></i></a></td>
        
        </tr>
      </table>
    </div>
  </div>
</aside>
      <section id="main">
  
  
    
    
      
        <div class="archive-year-wrap">
          <i class="fa fa-calendar"></i>
          <a href="/archives/2015" class="archive-year">2015</a>
        </div>
    
    <article id="post-Egg-demystified" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/31/Egg-demystified/">Egg Demystified</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/07/31/Egg-demystified/">
    <time datetime="2015-07-31T03:21:28.000Z" itemprop="datePublished">2015-07-31</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Coding/">程序语言</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Egg的定义："><a href="#Egg的定义：" class="headerlink" title="Egg的定义："></a>Egg的定义：</h3><p>Egg是Python中模块（module）的发布格式，类似于Java中Jar/War，或者Ruby中的gems。在最近发布<br>的<a href="https://www.python.org/dev/peps/pep-0427/" target="_blank" rel="noopener">PEP427</a>中，Python对模块的封装提供了一种新的格式wheel。wheel对模块的封装更加<br>彻底，但是wheel是一种发布包（distribution format），而egg除了可以作为发布包之外，还可以直接安装在sys.path中。</p>
<h3 id="Egg的内容："><a href="#Egg的内容：" class="headerlink" title="Egg的内容："></a>Egg的内容：</h3><p>Egg由于可以直接放在sys.path中安装使用，所以egg的发布形式是自我发现的。所谓的自我发现是因为，egg的发布包中包含了meta信息，<br>这些meta信息包括：</p>
<ul>
<li>该egg包可以提供的功能</li>
<li>该egg包需要依赖的外部环境</li>
</ul>
<p>由于egg包中meta信息的存在，egg安装包可以提供多版本的支持，比如你可以安装几个不同版本的pip包在python的sys.path中，是运行时<br>使用的时候，可以通过控制sys.path去调用需要的pip版本。这种多版本共存的分离与virtualenv的实现是不同的，virtualenv提供的是独<br>立的运行环境，而这里是直接安装了多版本的发布包。</p>
<h3 id="Egg的分类："><a href="#Egg的分类：" class="headerlink" title="Egg的分类："></a>Egg的分类：</h3><p>Egg在具体发布的时候是非常灵活的，包括以下的形式：</p>
<ul>
<li>built eggs<ul>
<li>built egg是指那些发布时使用目录形式或者zip形式，同时结尾必须是.egg，在zip或者目录的下面有一个子目录叫<code>EGG-INFO</code><ul>
<li>比如<code>pyreadline-2.0-py2.7-win32.egg</code>是一个zip文件，里面有一个<code>EGG-INFO</code>的子目录</li>
<li>或者<code>certifi-14.05.14-py2.7.egg</code>是一个目录，同样里面也有一个<code>EGG-INFO</code>的子目录</li>
</ul>
</li>
</ul>
</li>
<li>development eggs<ul>
<li>development egg是那些正常的目录，但是在正常的目录下面可能分布着一个或者多个的<code>ProjectName.egg-info</code>，其中<code>ProjectName.egg-info</code><br>中的<code>.egg-info</code>必须存在</li>
<li>development egg一般用来在没有指定版本号时提供默认的发布包</li>
</ul>
</li>
<li>egg links<ul>
<li>是一种提供跳转的链接文件，以<code>*.egg-link</code>为结尾，文件的内容是要跳转到的developement egg</li>
<li>一般用在某些操作系统不提供内生的符号链接(native symbol link)的场合</li>
</ul>
</li>
</ul>
<h3 id="pkg-resource的作用："><a href="#pkg-resource的作用：" class="headerlink" title="pkg_resource的作用："></a>pkg_resource的作用：</h3><p>用来内探或者发掘python环境中安装的模块，然后根据指定的版本号找到需要模块。</p>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><ol>
<li><a href="https://www.python.org/dev/peps/pep-0427/" target="_blank" rel="noopener">https://www.python.org/dev/peps/pep-0427/</a></li>
<li><a href="https://mail.python.org/pipermail/distutils-sig/2005-June/004652.html" target="_blank" rel="noopener">https://mail.python.org/pipermail/distutils-sig/2005-June/004652.html</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/07/31/Egg-demystified/" data-id="cjrjycrkl005jbatiwzn1chlr" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Egg/">Egg</a></li></ul>

    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Expect-PExpect-WPExpect" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/01/Expect-PExpect-WPExpect/">Pexpect and Interactive Interface with Linux</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/07/01/Expect-PExpect-WPExpect/">
    <time datetime="2015-07-01T10:11:00.000Z" itemprop="datePublished">2015-07-01</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Solutions/">方案</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="1-The-updated-and-latest-pexpect"><a href="#1-The-updated-and-latest-pexpect" class="headerlink" title="1. The updated and latest pexpect"></a>1. The updated and latest pexpect</h3><ul>
<li>Pure Python on Posix System</li>
<li><a href="https://github.com/pexpect/pexpect" target="_blank" rel="noopener">https://github.com/pexpect/pexpect</a></li>
</ul>
<h3 id="2-The-PExpect-on-windows-system"><a href="#2-The-PExpect-on-windows-system" class="headerlink" title="2. The PExpect on windows system"></a>2. The PExpect on windows system</h3><ul>
<li>wexpect <a href="http://sourceforge.net/p/dispcalgui/code/HEAD/tree/trunk/dispcalGUI/wexpect.py" target="_blank" rel="noopener">http://sourceforge.net/p/dispcalgui/code/HEAD/tree/trunk/dispcalGUI/wexpect.py</a><ul>
<li>Backup: <a href="https://gist.github.com/MengJueM/c95ec2228c1364cdc6d0" target="_blank" rel="noopener">https://gist.github.com/MengJueM/c95ec2228c1364cdc6d0</a></li>
</ul>
</li>
</ul>
<h3 id="3-The-WPexpect-on-windows-system"><a href="#3-The-WPexpect-on-windows-system" class="headerlink" title="3. The WPexpect on windows system"></a>3. The WPexpect on windows system</h3><ul>
<li>winexpect <a href="https://bitbucket.org/geertj/winpexpect/" target="_blank" rel="noopener">https://bitbucket.org/geertj/winpexpect/</a></li>
</ul>
<h3 id="References"><a href="#References" class="headerlink" title="References:"></a>References:</h3><ol>
<li><a href="http://www.reddit.com/r/Python/comments/pl25z/sarge_a_library_wrapping_the_subprocess_module/" target="_blank" rel="noopener">http://www.reddit.com/r/Python/comments/pl25z/sarge_a_library_wrapping_the_subprocess_module/</a></li>
<li><a href="https://groups.google.com/forum/#!topic/winpexpect/TsdIl1DRKhI" target="_blank" rel="noopener">https://groups.google.com/forum/#!topic/winpexpect/TsdIl1DRKhI</a></li>
<li><a href="https://github.com/pexpect/pexpect/issues/17" target="_blank" rel="noopener">https://github.com/pexpect/pexpect/issues/17</a></li>
<li><a href="https://github.com/takluyver/terminado" target="_blank" rel="noopener">https://github.com/takluyver/terminado</a></li>
<li><a href="https://github.com/pexpect/ptyprocess" target="_blank" rel="noopener">https://github.com/pexpect/ptyprocess</a></li>
<li><a href="https://gist.github.com/blink1073/9a0ea82efc84cb9216d0" target="_blank" rel="noopener">https://gist.github.com/blink1073/9a0ea82efc84cb9216d0</a></li>
<li><a href="https://pypi.python.org/pypi/trollius" target="_blank" rel="noopener">https://pypi.python.org/pypi/trollius</a></li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/07/01/Expect-PExpect-WPExpect/" data-id="cjrjycrkt005zbatinr2cfng3" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pexpect/">Pexpect</a></li></ul>

    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-QComboBox-with-StardardItemModel-QTimer-Issue" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/01/QComboBox-with-StardardItemModel-QTimer-Issue/">复盘一个关于QComboBox的issue</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/06/01/QComboBox-with-StardardItemModel-QTimer-Issue/">
    <time datetime="2015-06-01T04:46:00.000Z" itemprop="datePublished">2015-06-01</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Coding/">程序语言</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这个最近遇到的一个小问题，但是花了一天时间找到了<a href="http://stackoverflow.com/questions/19887777/error-in-model-view-implemention-of-gui-in-pyqt" target="_blank" rel="noopener">答案</a>，下面是详细复盘：</p>
<h3 id="1-先看一个最简单的示例："><a href="#1-先看一个最简单的示例：" class="headerlink" title="1. 先看一个最简单的示例："></a>1. 先看一个最简单的示例：</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">from PyQt4.QtGui import *</span><br><span class="line">from PyQt4.QtCore import Qt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line"></span><br><span class="line">    from PyQt4.QtGui import QDialog</span><br><span class="line">    mywin = QDialog()</span><br><span class="line">    mywin.setMinimumSize(400, 400)</span><br><span class="line"></span><br><span class="line">    model = QStandardItemModel()</span><br><span class="line"></span><br><span class="line">    for i, word in enumerate([&apos;hola&apos;, &apos;adios&apos;, &apos;hello&apos;, &apos;good bye&apos;]):</span><br><span class="line">        item = QStandardItem(word)</span><br><span class="line">        model.setItem(i, 0, item)</span><br><span class="line"></span><br><span class="line">    combo = QComboBox(mywin)</span><br><span class="line">    combo.setModel(model)</span><br><span class="line">    bombo.setEditable(True)</span><br><span class="line">    mywin.show()</span><br><span class="line"></span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure>
<p>如果在<code>Python 2.7.9</code>以及<code>PyQt 4.11.3</code>下运行，则一定会出现如下的warning:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">QObject::startTimer: QTimer can only be used with threads started with QThread</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<p>不是什么大的问题，但是本着本人比较洁癖的心理习惯，还是想弄个明白。先仔细研究了QComboBox的<a href="http://doc.qt.io/qt-4.8/qcombobox.html" target="_blank" rel="noopener">文档</a>，没有发现什么端倪，也没有在使用QComboBox时有特别的使用习惯。然后我开始调整代码，看是怎么回事：</p>
<h3 id="2-错误可以消失的代码："><a href="#2-错误可以消失的代码：" class="headerlink" title="2. 错误可以消失的代码："></a>2. 错误可以消失的代码：</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">from PyQt4.QtGui import *</span><br><span class="line">from PyQt4.QtCore import Qt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line"></span><br><span class="line">    from PyQt4.QtGui import QDialog</span><br><span class="line">    mywin = QDialog()</span><br><span class="line">    mywin.setMinimumSize(400, 400)</span><br><span class="line"></span><br><span class="line">    model = QStandardItemModel()</span><br><span class="line"></span><br><span class="line">    for i, word in enumerate([&apos;hola&apos;, &apos;adios&apos;, &apos;hello&apos;, &apos;good bye&apos;]):</span><br><span class="line">        item = QStandardItem(word)</span><br><span class="line">        model.setItem(i, 0, item)</span><br><span class="line"></span><br><span class="line">    combo = QComboBox(mywin)</span><br><span class="line">    combo.setModel(model)</span><br><span class="line"></span><br><span class="line">    mywin.show()</span><br><span class="line"></span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure>
<p>如果仔细的比较两段代码，可以发现实际上是只把<code>combo.setEditable(True)</code>删除了。PyQt4种QComboBox的默认值是<code>setEditable(False)</code>，那这里的<code>setEditable(True)</code>就是问题的<code>root cause</code>了。</p>
<h3 id="3-再看另外一段代码："><a href="#3-再看另外一段代码：" class="headerlink" title="3. 再看另外一段代码："></a>3. 再看另外一段代码：</h3><p>我们如果想使用和保留<code>setEditable(True)</code>，那么我们可以尝试不用PyQt的MVC模式，而直接在QComboBox里插入items，如下代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">from PyQt4.QtGui import *</span><br><span class="line">from PyQt4.QtCore import Qt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line"></span><br><span class="line">    from PyQt4.QtGui import QDialog</span><br><span class="line">    mywin = QDialog()</span><br><span class="line">    mywin.setMinimumSize(400, 400)</span><br><span class="line"></span><br><span class="line">    # model = QStandardItemModel()</span><br><span class="line">    #</span><br><span class="line">    # for i, word in enumerate([&apos;hola&apos;, &apos;adios&apos;, &apos;hello&apos;, &apos;good bye&apos;]):</span><br><span class="line">    #     item = QStandardItem(word)</span><br><span class="line">    #     model.setItem(i, 0, item)</span><br><span class="line"></span><br><span class="line">    combo = QComboBox(mywin)</span><br><span class="line">    combo.addItems([&apos;hola&apos;, &apos;adios&apos;, &apos;hello&apos;, &apos;good bye&apos;])</span><br><span class="line">    # combo.setModel(model)</span><br><span class="line"></span><br><span class="line">    mywin.show()</span><br><span class="line"></span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure>
<p>可以发现，没有什么问题，如果我们不使用model。</p>
<h3 id="4-我们想使用MVC，而且也要使用QComboBox-setEditable-True"><a href="#4-我们想使用MVC，而且也要使用QComboBox-setEditable-True" class="headerlink" title="4. 我们想使用MVC，而且也要使用QComboBox.setEditable(True)"></a>4. 我们想使用MVC，而且也要使用<code>QComboBox.setEditable(True)</code></h3><p>我们使用前面三段的对比代码，可以知道，问题的根源在于PyQt的垃圾回收机制：</p>
<ul>
<li>PyQt是对Qt的python封装，PyQt的底层AWT（Abstract Widget Toolkit）实现是由Qt实现的</li>
<li>Qt是由<code>C++</code>实现的</li>
<li>PyQt的垃圾回收涉及两部分内容：<ul>
<li>Python部分的垃圾回收</li>
<li><code>C++</code>部分的垃圾回收</li>
</ul>
</li>
</ul>
<p>因此我们在外部使用Python创建的Model，需要显式(explicitly)地指定parent，以便底层的Qt可以正确取得它<br>的控制权。</p>
<p>因此，要修复我们的示例就很简单了：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">from PyQt4.QtGui import *</span><br><span class="line">from PyQt4.QtCore import Qt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line"></span><br><span class="line">    from PyQt4.QtGui import QDialog</span><br><span class="line">    mywin = QDialog()</span><br><span class="line">    mywin.setMinimumSize(400, 400)</span><br><span class="line">    combo = QComboBox(mywin)</span><br><span class="line"></span><br><span class="line">    model = QStandardItemModel(combo)</span><br><span class="line"></span><br><span class="line">    for i, word in enumerate([&apos;hola&apos;, &apos;adios&apos;, &apos;hello&apos;, &apos;good bye&apos;]):</span><br><span class="line">        item = QStandardItem(word)</span><br><span class="line">        model.setItem(i, 0, item)</span><br><span class="line"></span><br><span class="line">    combo.setModel(model)</span><br><span class="line"></span><br><span class="line">    mywin.show()</span><br><span class="line"></span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure>
<p>仔细比较前面的代码，我们可以看到改动点是<code>model = QStandardItemModel(combo)</code>，<br>这里显式的指定了combo控件对象作为model的父对象，然后Qt在资源回收时，就能确定<br>正确的资源回收顺序，而不会导致开头的错误出现。</p>
<h3 id="5-一个更大型的示例："><a href="#5-一个更大型的示例：" class="headerlink" title="5. 一个更大型的示例："></a>5. 一个更大型的示例：</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">from PyQt4.QtCore import Qt</span><br><span class="line">from PyQt4.QtGui import QCompleter, QComboBox, QSortFilterProxyModel, QDialog</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ExtendedComboBox(QComboBox):</span><br><span class="line">    def __init__(self, parent=None):</span><br><span class="line">        super(ExtendedComboBox, self).__init__(parent)</span><br><span class="line"></span><br><span class="line">        self.setFocusPolicy(Qt.StrongFocus)</span><br><span class="line">        self.setEditable(True)</span><br><span class="line"></span><br><span class="line">        self.filter_model = QSortFilterProxyModel(self)</span><br><span class="line">        self.filter_model.setFilterCaseSensitivity(Qt.CaseInsensitive)</span><br><span class="line">        self.filter_model.setSourceModel(self.model())</span><br><span class="line"></span><br><span class="line">        self.completer = QCompleter(self.filter_model, self)</span><br><span class="line">        self.completer.setCompletionMode(QCompleter.UnfilteredPopupCompletion)</span><br><span class="line">        self.setCompleter(self.completer)</span><br><span class="line"></span><br><span class="line">        self.lineEdit().textEdited[unicode].connect(</span><br><span class="line">            self.filter_model.setFilterFixedString)</span><br><span class="line">        self.completer.activated.connect(self.on_completer_activated)</span><br><span class="line"></span><br><span class="line">    def on_completer_activated(self, text):</span><br><span class="line">        if text:</span><br><span class="line">            index = self.findText(text)</span><br><span class="line">            self.setCurrentIndex(index)</span><br><span class="line"></span><br><span class="line">    def setModel(self, model):</span><br><span class="line">        super(ExtendedComboBox, self).setModel(model)</span><br><span class="line">        self.filter_model.setSourceModel(model)</span><br><span class="line">        self.completer.setModel(self.filter_model)</span><br><span class="line"></span><br><span class="line">    def setModelColumn(self, column):</span><br><span class="line">        self.completer.setCompletionColumn(column)</span><br><span class="line">        self.filter_model.setFilterKeyColumn(column)</span><br><span class="line">        super(ExtendedComboBox, self).setModelColumn(column)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    import sys</span><br><span class="line">    from PyQt4.QtGui import QApplication, QStandardItemModel</span><br><span class="line">    from PyQt4.QtGui import QStandardItem, QVBoxLayout</span><br><span class="line"></span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line">    win = QDialog()</span><br><span class="line">    win.setMinimumSize(400, 400)</span><br><span class="line">    combo = ExtendedComboBox()</span><br><span class="line">    layout = QVBoxLayout()</span><br><span class="line">    win.setLayout(layout)</span><br><span class="line">    model = QStandardItemModel(combo)</span><br><span class="line">    for i, word in enumerate([&apos;hola&apos;, &apos;adios&apos;, &apos;hello&apos;, &apos;good bye&apos;]):</span><br><span class="line">        item = QStandardItem(word)</span><br><span class="line">        model.setItem(i, 0, item)</span><br><span class="line"></span><br><span class="line">    combo.setModel(model)</span><br><span class="line">    layout.addWidget(combo)</span><br><span class="line">    win.show()</span><br><span class="line"></span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/06/01/QComboBox-with-StardardItemModel-QTimer-Issue/" data-id="cjrjycrq200fvbatithuwt5zz" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PyQt/">PyQt</a></li></ul>

    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Recommend-CamingoCod-as-a-coding-font" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/01/Recommend-CamingoCod-as-a-coding-font/">推荐一个编程字体： Camingocode</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/06/01/Recommend-CamingoCod-as-a-coding-font/">
    <time datetime="2015-06-01T04:44:00.000Z" itemprop="datePublished">2015-06-01</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Recommend/">推荐</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Download: <a href="http://www.janfromm.de/typefaces/camingomono/camingocode/" target="_blank" rel="noopener">http://www.janfromm.de/typefaces/camingomono/camingocode/</a></p>
<p>在我的4K显示器上表现很棒，特别推荐。</p>
<p>顺便推荐一下我之前用的编程字体们，也是非常不错的：</p>
<ul>
<li>M+ 1M</li>
<li>PRAGMATA PRO</li>
</ul>
<h4 id="推荐博客："><a href="#推荐博客：" class="headerlink" title="推荐博客："></a>推荐博客：</h4><ul>
<li><a href="http://typecast.com/blog/10-fonts-for-code" target="_blank" rel="noopener">http://typecast.com/blog/10-fonts-for-code</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/06/01/Recommend-CamingoCod-as-a-coding-font/" data-id="cjrjycrq800g6batirq6jkc4b" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fonts/">Fonts</a></li></ul>

    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Gitlab-Omnibus-Service-Others" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/19/Gitlab-Omnibus-Service-Others/">使用Gitlab的内置nginx去服务其他静态内容</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/05/19/Gitlab-Omnibus-Service-Others/">
    <time datetime="2015-05-19T05:05:00.000Z" itemprop="datePublished">2015-05-19</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Solutions/">方案</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>有时候，我们使用gitlab官方提供的deb去安装时，gitlab使用了内嵌的nginx服务，使用<br>chef去管理nginx的配置文件，所以如果我们在gitlab的服务器上想要使用其他的nginx服务<br>就很不方便，gitlab官方提供了<a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/nginx.md" target="_blank" rel="noopener">方案</a>是：</p>
<ul>
<li>停用内嵌的nginx，而使用外部的nginx，然后在外部的nginx安装文件里装入gitlab的配置</li>
</ul>
<p>但是如果我们不想再安装外部的nginx，而直接使用内嵌的nginx，可以使用如下方案：</p>
<ul>
<li><a href="http://stackoverflow.com/questions/24090624/using-gitlabs-nginx-to-serve-another-app" target="_blank" rel="noopener">修改</a>nginx的chef recipes</li>
</ul>
<p>这个方法很好用，当然我们也可以直接修改：</p>
<ul>
<li>在原来的nginx配置文件(<code>/opt/gitlab/embedded/cookbooks/gitlab/recipes/nginx.rb</code>)中加入自定义的内容</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/05/19/Gitlab-Omnibus-Service-Others/" data-id="cjrjycrlo007gbatijqmd1ld9" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Gitlab/">Gitlab</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li></ul>

    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Python-GC-and-Destructure" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/15/Python-GC-and-Destructure/">Python GC and Destructure</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/05/15/Python-GC-and-Destructure/">
    <time datetime="2015-05-15T10:00:00.000Z" itemprop="datePublished">2015-05-15</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Innards/">内核</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>先看一个示例：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">In [1]:</span><br><span class="line"></span><br><span class="line">class Foo:</span><br><span class="line">    def __init__(self, x):</span><br><span class="line">        print &quot;Foo: Hi&quot;</span><br><span class="line">        self.x = x</span><br><span class="line">    def __del__(self):</span><br><span class="line">        print &quot;Foo: bye&quot;</span><br><span class="line"></span><br><span class="line">class Bar:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        print &quot;Bar: Hi&quot;</span><br><span class="line">        self.foo = Foo(self) # x = this instance</span><br><span class="line"></span><br><span class="line">    def __del__(self):</span><br><span class="line">        print &quot;Bar: Bye&quot;</span><br><span class="line"></span><br><span class="line">bar = Bar()</span><br><span class="line"># del bar # This doesn&apos;t work either.</span><br><span class="line">Bar: Hi</span><br><span class="line">Foo: Hi</span><br><span class="line">In [2]:</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">In [3]:</span><br><span class="line"></span><br><span class="line">sys.getrefcount(bar)</span><br><span class="line">Out[3]:</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p>这里的destructor在对象被销毁的时候并没有被调用，原因就是：</p>
<ul>
<li>Cyle Reference</li>
<li>CPython的实现在对象的GC是基于简单的reference count</li>
</ul>
<p>即使我们使用<code>del bar</code>这样的操作，也不会触发destructor，原始是：</p>
<ul>
<li>当前的对象的reference count是3</li>
<li>del只会让reference count减1</li>
</ul>
<p>根据文档：</p>
<blockquote>
<p>“del x” doesn’t directly call <code>x.__del__()</code> — the former decrements the reference count for x by one, and the latter is only called when x’s reference count reaches zero. Some common situations that may prevent the reference count of an object from going to zero include: circular references between objects</p>
</blockquote>
<p>也就是说<code>x.__del__</code>跟<code>del x</code>不是同义的，并且根据文档，如果在cycle reference的对象<br>中使用<code>__del__</code>将会造成内存泄露：</p>
<blockquote>
<p>Circular references which are garbage are detected when the option cycle detector is enabled (it’s on by default), but can only be cleaned up if there are no Python-level <code>__del__()</code> methods involved.</p>
</blockquote>
<blockquote>
<p>A list of objects which the collector found to be unreachable but could not be freed (uncollectable objects). By default, this list contains only objects with <code>__del__()</code> methods.26.1Objects that have <code>__del__()</code> methods and are part of a reference cycle cause the entire reference cycle to be uncollectable, including objects not necessarily in the cycle but reachable only from it. Python doesn’t collect such cycles automatically because, in general, it isn’t possible for Python to guess a safe order in which to run the <code>__del__()</code> methods. […] It’s generally better to avoid the issue by not creating cycles containing objects with <code>__del__()</code> methods</p>
</blockquote>
<h3 id="程序退出时，destructor会被调用吗？"><a href="#程序退出时，destructor会被调用吗？" class="headerlink" title="程序退出时，destructor会被调用吗？"></a>程序退出时，destructor会被调用吗？</h3><p><a href="http://www.python.org/search/hypermail/python-1993/0109.html" target="_blank" rel="noopener">答案</a>是不确定。</p>
<blockquote>
<p>One final thing to ponder: if we have a <code>__del__</code> method, should the interpreter guarantee that it is called when the program exits? (Like C++, which guarantees that destructors of global variables are called.) The only way to guarantee this is to go running around all modules and delete all their variables. But this means that <code>__del__</code> method cannot trust that any global variables it might want to use still exist, since there is no way to know in what order variables are to be deleted.</p>
</blockquote>
<h3 id="Exception-in-del"><a href="#Exception-in-del" class="headerlink" title="Exception in __del__"></a>Exception in <code>__del__</code></h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">def __del__(self):</span><br><span class="line">    raise Exception(&quot;Oopsy&quot;)</span><br><span class="line">    print &quot;Bar: Bye&quot;</span><br><span class="line"></span><br><span class="line">Exception exceptions.Exception: Exception(&apos;Oopsy&apos;,) in &gt; ignored</span><br><span class="line">Bar: Hi</span><br><span class="line">Foo: Hi</span><br><span class="line">Foo: bye</span><br></pre></td></tr></table></figure>
<p>会被忽略，只是编译器会有warning。</p>
<h3 id="修正后的版本："><a href="#修正后的版本：" class="headerlink" title="修正后的版本："></a>修正后的版本：</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import weakref</span><br><span class="line"></span><br><span class="line">class Foo:</span><br><span class="line">    def __init__(self, x):</span><br><span class="line">        print &quot;Foo: Hi&quot;</span><br><span class="line">        self.x = weakref.ref(x)</span><br><span class="line">    def __del__(self):</span><br><span class="line">        print &quot;Foo: bye&quot;</span><br><span class="line"></span><br><span class="line">class Bar:</span><br><span class="line">    def __init__(self):</span><br><span class="line">        print &quot;Bar: Hi&quot;</span><br><span class="line">        self.foo = Foo(self) # x = this instance</span><br><span class="line"></span><br><span class="line">    def __del__(self):</span><br><span class="line">        print &quot;Bar: Bye&quot;</span><br></pre></td></tr></table></figure>
<h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><p>[1] <a href="http://mindtrove.info/python-weak-references/" target="_blank" rel="noopener">http://mindtrove.info/python-weak-references/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/05/15/Python-GC-and-Destructure/" data-id="cjrjycrpy00flbatiroxa1rzj" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Destruction/">Destruction</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GC/">GC</a></li></ul>

    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Weighted-Random-Distribution" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/15/Weighted-Random-Distribution/">随机权重分布的Python实现</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/05/15/Weighted-Random-Distribution/">
    <time datetime="2015-05-15T08:58:00.000Z" itemprop="datePublished">2015-05-15</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Algo/">算法</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>原文：<a href="http://www.electricmonk.nl/log/2009/12/23/weighted-random-distribution/" target="_blank" rel="noopener">http://www.electricmonk.nl/log/2009/12/23/weighted-random-distribution/</a></p>
<p>Randomly selecting elements from a set of items is easy. Just generate a random number between 0 and the length of the set minus one, and use that as an index in the set (if it is an array) to get a random entry. The chance that an entry is picked is the same for each entry in the set. This is called even distribution or uniform distribution.</p>
<p>But what if we do not want each entry to appear as much as every other? Suppose we’re creating a question-answer game, and we want the questions the user got wrong previously to appear more often than the question he or she got right? This is called a Weighted Random Distribution, or sometimes Weighted Random Choice, and there are multiple methods of implementing such as random picker.</p>
<p>This article explains these various methods of implementing Weighted Random Distribution along with their pros and cons. We use Python as our language of choice, because it has an easy to read syntax, and provides many useful tools which would take many more lines of code in most other languages. Along the way all Python “tricks” will be explained.</p>
<p>分为几种实现：</p>
<h3 id="Expanding"><a href="#Expanding" class="headerlink" title="Expanding"></a>Expanding</h3><pre><code>#!/usr/bin/python

import random

weights = {
        &apos;A&apos;: 2,
        &apos;B&apos;: 4,
        &apos;C&apos;: 3,
        &apos;D&apos;: 1
}

dist = []
for x in weights.keys():
        dist += weights[x] * x

results = {}
for i in range(100000):
        wRndChoice = random.choice(dist)
        results[wRndChoice] = results.get(wRndChoice, 0) + 1

print results
</code></pre><h3 id="In-Place-Unsorted"><a href="#In-Place-Unsorted" class="headerlink" title="In-Place(Unsorted)"></a>In-Place(Unsorted)</h3><pre><code>#!/usr/bin/python

import random

weights = {
        &apos;A&apos;: 2,
        &apos;B&apos;: 4,
        &apos;C&apos;: 3,
        &apos;D&apos;: 1
}

wTotal = sum(weights.values())

results = {}
for i in range(100000):
        wRndNr = random.randint(0, wTotal - 1)
        s = 0
        for w in weights.items():
                s += w[1]
                if s &gt; wRndNr:
                        break;
        results[w[0]] = results.get(w[0], 0) + 1

print results
</code></pre><h3 id="In-Place-Sorted"><a href="#In-Place-Sorted" class="headerlink" title="In-Place(Sorted)"></a>In-Place(Sorted)</h3><pre><code>results = {}
for i in range(100000):
        wRndNr = random.randint(0, wTotal - 1)
        s = wTotal
        for i in xrange(len(sWeights) - 1, -1, -1):
                wRndChoice = sWeights[i]
                s -= wRndChoice[1]
                if s &lt;= wRndNr:
                        break
        results[wRndChoice[0]] = results.get(wRndChoice[0], 0) + 1
print results
</code></pre><h3 id="Pre-calculation"><a href="#Pre-calculation" class="headerlink" title="Pre-calculation"></a>Pre-calculation</h3><pre><code>wTotal = 0
sWeights = []
for w in weights.items():
    wTotal += w[1]
    sWeights.append( (wTotal, w[0]) )
    results = {}
for i in range(100000):
    wRndNr = random.randint(0, wTotal - 1)
    wRndChoice = sWeights[bisect.bisect(sWeights, (wRndNr, None))]

    results[wRndChoice[1]] = results.get(wRndChoice[1], 0) + 1
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/05/15/Weighted-Random-Distribution/" data-id="cjrjycrsr00kpbatiltbhai8k" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Recommend-A-Blog-Electric-Monk" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/15/Recommend-A-Blog-Electric-Monk/">推荐一个博客：www.electricmonk.nl</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/05/15/Recommend-A-Blog-Electric-Monk/">
    <time datetime="2015-05-15T08:45:00.000Z" itemprop="datePublished">2015-05-15</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Recommend/">推荐</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>博客站：<a href="http://www.electricmonk.nl/log" target="_blank" rel="noopener">http://www.electricmonk.nl/log</a></li>
<li>博主：<strong>Ferry Boender</strong></li>
<li>博客内容：Python，算法</li>
<li>好文章：<a href="http://www.electricmonk.nl/log/2009/12/23/weighted-random-distribution/" target="_blank" rel="noopener">http://www.electricmonk.nl/log/2009/12/23/weighted-random-distribution/</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/05/15/Recommend-A-Blog-Electric-Monk/" data-id="cjrjycrq600g2batisjz7st0c" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Python-Innard-Introduction" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/14/Python-Innard-Introduction/">Python Innard: Introduction</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/05/14/Python-Innard-Introduction/">
    <time datetime="2015-05-14T09:55:00.000Z" itemprop="datePublished">2015-05-14</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Innards/">内核</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>翻译：《Python的内核揭秘（一）：入门》</p>
<p>一个朋友曾经对我说：“你懂的，对某些人来说，C语言就是一堆扩展自汇编的宏”。这句话<br>是在数年前（好吧，是在llvm之前）说的，但是这话也让我语塞。Kernighan和Richie真的<br>可以在看到C语言的代码的时候可以立即解析为汇编代码？或者Tim Berners-Lee在浏览网页<br>的时候跟你我看到的内容都不同？或者Keanu Reeves在看一个新出炉的乱七八糟的汤的时候，<br>看到的究竟跟别人有啥差别？或者，严肃的说，他有看到什么玄机吗？好吧，无论如何，我<br>们回到程序，Guido van Rossum看到的Python跟别人不同吗？</p>
<p>这篇文章是我在研究Python的内核的时候写的一系列文章的开头，我之所以写这些文章是因<br>为我觉得能够解释清楚一个东西是深刻理解一个东西的最好的方法，我在这里很愿意把我在<br>读Python代码时的心得写在这里去尝试解释Python中到底发生了什么。在这个系列文章里，<br>我主要讨论的是CPython、py3k、bytecode以及其他（unladen swallow、Jython、Cython）<br>Python相关或者类似的代码。当我在这里说Python的时候，主要说的是CPython，运行的平台<br>是posix OS，比如linux。如果你想知道Python是怎么工作的，你应该读我的文章；如果你想<br>为CPython贡献代码，你也应该读我的文章。如果有发现任何错误的地方，你可以在后面写下<br>你的意见。</p>
<p>我在这里会写下所有关于我在读Python源代码时的心得，但是偶尔也会参考一个资料，比如<br><a href="http://docs.python.org/py3k/c-api/index.html" target="_blank" rel="noopener">这个</a>或者<a href="http://docs.python.org/py3k/extending/index.html" target="_blank" rel="noopener">另个</a>或者一些<a href="http://tech.blog.aknin.name/2010/05/07/searching-mailing-list-archives-offline/" target="_blank" rel="noopener">邮件列表</a>及<a href="http://tech.blog.aknin.name/2010/05/07/searching-mailing-list-archives-offline/" target="_blank" rel="noopener">其他</a>。我把所有的资料都放在一起，希望你可以<br>通过订阅方便阅读。在读我的文章之前，我假设你已经知道一些C语言知识、操作系统理论、<br>一些汇编、或者一些Unix的爱好。如果没有这些知识也没有关系，但是我不保证你可以顺利<br>地理解。另外，如果你还没有那些为Python开发所需要的工具链，你可以参考<a href="http://tech.blog.aknin.name/2010/04/08/contributing-to-python/" target="_blank" rel="noopener">这里</a>。</p>
<p>首先，我们从一些假设你已经知道的知识开始，但是我认为他们从我理解的角度是重要的。<br>Python使用虚拟机（VM）去执行代码，你必须要对虚拟机有一个比较好的认识，你可以把<br>Python的虚拟机当作是JVM，而不是Virtualbox。我发现从字面意义上理解虚拟机会更容易<br>懂，它一个用软件打造的机器。CPU是一个电子仪器，用来接受输入（比如data、machine<br>code），有一个状态（register），然后根据状态+输入数据可以得到输出的结果到RAM或者<br>Bus。Python的虚拟机也是这样一个机器，使用软件打造，接受机器码输入，有一个状态。这<br>个虚拟机存在于宿主的一个进程中。</p>
<p>让我们从一个具体的代码来对Python虚拟机有一个大概的理解，当你做<code>$python -c &#39;print
(&quot;Hello, world!&quot;)&#39;</code>的时候，Python的二进制代码被执行了，标准的C代码库被初始化，然<br>后主程序开始执行（可以参考源代码<code>./Modules/python.c</code> <code>./Modules/main.c: Py_Main</code>）。<br>在一些常见的初始化（输入参数解析、环境变量解析等）之后，<a href="http://docs.python.org/c-api/init.html#Py_Initialize" target="_blank" rel="noopener">./Python/pythonrun.c: Py_Initialize</a>被调用。这个<br>函数是用来build和assemble，然后去运行虚拟机的，它创立了两个重要的数据结构：<br><code>interpreter state</code>和<code>thread state</code>。同时也创建了sys模块和builtins模块。我们在后<br>面会深入的解释这些概念。</p>
<p>当这些都完成之后，Python接下来的行动是基于它要如何执行代码：</p>
<ul>
<li><code>-c</code>option，用来执行一个字符串</li>
<li><code>-m</code>option，用来执行模块</li>
<li>执行一个python文件</li>
<li>运行REPL loop，交互模式</li>
</ul>
<p>对于我们的示例，我们将会执行一个字符串。为了执行这个字符串，<code>./Python/pythonrun.c:
PyRun_SimpleStringFlags</code>将会被调用。这个函数创建了<code>__main__</code>命名空间，这个命名空<br>间将会被用来执行我们的字符串。比如你运行<code>$ python -c &#39;a=1; print(a)&#39;</code>，a将会被存<br>储在这个命名空间里。在命名空间被创建后，字符串就会在这里被执行，或者也可以理解为<br>评估（evaluate）或者解析（interpreter）。但是，首先你必须把字符串转换为机器可以<br>执行的东西。</p>
        
          <p class="article-more-link">
            <a href="/2015/05/14/Python-Innard-Introduction/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/05/14/Python-Innard-Introduction/" data-id="cjrjycru500mrbatiloylro4o" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CPython/">CPython</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python-Implementation/">Python Implementation</a></li></ul>

    </footer>
  </div>
  
</article>


  
    
    
    <article id="post-Python-Internal-Recommend-Articles" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/05/14/Python-Internal-Recommend-Articles/">推荐一个博客：Python Internals</a>
    </h1>
  

        <div class="article-meta">
          <div class="article-date">
  <i class="fa fa-calendar"></i>
  <a href="/2015/05/14/Python-Internal-Recommend-Articles/">
    <time datetime="2015-05-14T09:05:00.000Z" itemprop="datePublished">2015-05-14</time>
  </a>
</div>
          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Recommend/">推荐</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>博客：<a href="http://tech.blog.aknin.name/category/my-projects/pythons-innards/" target="_blank" rel="noopener">http://tech.blog.aknin.name/category/my-projects/pythons-innards/</a><br>博主：<a href="http://en.gravatar.com/yanivaknin" target="_blank" rel="noopener">Yaniv Aknin</a><br>内容：Python的内部实现及分析</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://m.imf.cc/2015/05/14/Python-Internal-Recommend-Articles/" data-id="cjrjycrps00f7batiezymaiup" class="article-share-link">分享到</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CPython/">CPython</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python-Implementation/">Python Implementation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python-Internals/">Python Internals</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/archives/page/29/">&laquo; 上一页</a><a class="page-number" href="/archives/">1</a><span class="space">&hellip;</span><a class="page-number" href="/archives/page/28/">28</a><a class="page-number" href="/archives/page/29/">29</a><span class="page-number current">30</span><a class="page-number" href="/archives/page/31/">31</a><a class="page-number" href="/archives/page/32/">32</a><a class="extend next" rel="next" href="/archives/page/31/">下一页 &raquo;</a>
    </nav>
  
</section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTML5/">HTML5</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Innards/">内核</a><span class="category-list-count">48</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Functional-Programming/">函数编程</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Dynamic-Programming/">动态编程</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Fun/">好玩</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">安卓</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Recommend/">推荐</a><span class="category-list-count">57</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">数学</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">数据库</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Solutions/">方案</a><span class="category-list-count">64</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MachineLearning/">机器学习</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Testing/">测试</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Coding/">程序语言</a><span class="category-list-count">71</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Notes/">笔记</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algo/">算法</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Automation/">自动化</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ComputerVision/">计算机视觉</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Review/">评测</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Interview/">面试</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">49</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">32</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">30</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">24</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">十月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">八月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">六月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">四月 2014</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Meng Jue (M)<br>
    </div>
  </div>
</footer>

    



<script src="/js/jquery-2.2.0.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>